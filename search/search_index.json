{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"C-GEM Network","text":"Carbon-Generic Estuary Model for Multi-Branch Networks <p>A specialized 1D biogeochemical model for tidal river deltas</p> <ul> <li> <p> Introduction</p> <p>Introduction to C-GEM Network's purpose and capabilities</p> <p> Learn more</p> </li> <li> <p> Hydrodynamics</p> <p>Saint-Venant equations on staggered grid with Savenije's estuarine theory</p> <p> Learn more</p> </li> <li> <p> Transport</p> <p>TVD advection-dispersion with tidal dispersion and salinity intrusion</p> <p> Learn more</p> </li> <li> <p> Biogeochemistry</p> <p>C-RIVE module: carbon, nutrients, oxygen, and greenhouse gases</p> <p> Learn more</p> </li> <li> <p> Calibration</p> <p>NLopt-powered optimization with seasonal data support</p> <p> Learn more</p> </li> </ul>"},{"location":"#why-c-gem","title":"Why C-GEM?","text":"<p>C-GEM Network fills a critical niche for rapid, process-based biogeochemical modeling of complex deltaic networks:</p> Feature C-GEM 2D/3D Models Setup time Hours Days-Weeks Run time (30 days) Minutes Hours-Days Network topology Native support Requires complex meshing Biogeochemistry Full C-RIVE Limited WQ modules GHG emissions CO\u2082, CH\u2084, N\u2082O Often missing Calibration Built-in NLopt External tools <p>Learn more</p>"},{"location":"#quick-start","title":"Quick Start","text":"Windows (PowerShell)Linux/macOS <pre><code># Clone and build\ngit clone https://github.com/nguytruonganlab/CGEM_network.git\ncd CGEM_network\n.\\scripts\\build-and-run.ps1 -r Mekong_Delta_Full\n\n# Or step-by-step\n.\\scripts\\build.bat\n.\\bin\\Debug\\CGEM_Network.exe INPUT/Cases/Mekong_Delta_Full/case_config.txt\n</code></pre> <pre><code># Clone and build\ngit clone https://github.com/nguytruonganlab/CGEM_network.git\ncd CGEM_network\nmake\n./bin/CGEM_Network INPUT/Cases/Mekong_Delta_Full/case_config.txt\n</code></pre> <p>Learn more - Quick start guide to run your first simulation</p> <p>Learn more - Installation instructions for all platforms</p>"},{"location":"#key-features","title":"Key Features","text":"<ul> <li>Multi-branch network topology \u2014 bifurcations, confluences, distributaries</li> <li>Computationally efficient \u2014 1D, runs in seconds to minutes</li> <li>Complete carbon cycle \u2014 DIC, TA, pH, pCO\u2082, CO\u2082 air-water flux</li> <li>Greenhouse gas emissions \u2014 CO\u2082, CH\u2084, N\u2082O with process attribution</li> <li>C-RIVE biogeochemistry \u2014 6-pool organic matter, 2-step nitrification</li> <li>Automatic calibration \u2014 NLopt integration with seasonal objectives</li> <li>Open source \u2014 ANSI C, portable, transparent</li> </ul>"},{"location":"#architecture-overview","title":"Architecture Overview","text":"<pre><code>flowchart TB\n    subgraph cgem[C-GEM Network]\n        hydro[Hydrodynamics&lt;br/&gt;Saint-Venant&lt;br/&gt;Staggered grid]\n        transport[Transport&lt;br/&gt;Advective-dispersive&lt;br/&gt;TVD schemes]\n        biogeo[Biogeochemistry&lt;br/&gt;C-RIVE + GHG module]\n        solver[Network Solver&lt;br/&gt;Junction mass balance&lt;br/&gt;Multi-branch iteration&lt;br/&gt;Implicit time stepping&lt;br/&gt;Boundary conditions]\n        hydro --&gt; transport --&gt; biogeo --&gt; solver\n        solver --&gt; calibration[Calibration&lt;br/&gt;NLopt + seasonal objectives]\n        solver --&gt; ioManager[I/O Manager&lt;br/&gt;CSV &amp; NetCDF&lt;br/&gt;Config]\n        solver --&gt; output[Output&lt;br/&gt;Binary/CSV&lt;br/&gt;Time series]\n    end</code></pre> <p>Learn more - Detailed architecture and source code structure</p>"},{"location":"#case-studies","title":"Case Studies","text":"<ul> <li> <p> Mekong Delta</p> <p>4-branch network, seasonal calibration, full biogeochemistry</p> <p> View case study</p> </li> <li> <p> Tien River</p> <p>Single distributary test case for validation</p> <p> View case study</p> </li> </ul> <p>Learn more - Full user guide and case study of Mekong Delta</p>"},{"location":"#citation","title":"Citation","text":"<p>If you use C-GEM Network, please cite:</p> <pre><code>@software{cgem_network_2025,\n  title = {C-GEM Network: Carbon-Generic Estuary Model for Multi-Branch Networks},\n  author = {Nguyen, Truong and CGEM Development Team},\n  year = {2025},\n  url = {https://github.com/nguytruonganlab/CGEM_network}\n}\n</code></pre>"},{"location":"#license","title":"License","text":"<p>C-GEM Network is released under the MIT License.</p>"},{"location":"about/changelog/","title":"Changelog","text":"<p>All notable changes to C-GEM Network will be documented in this file.</p> <p>The format is based on Keep a Changelog, and this project adheres to Semantic Versioning.</p>"},{"location":"about/changelog/#100-2025-12-01","title":"[1.0.0] - 2025-12-01","text":""},{"location":"about/changelog/#added","title":"Added","text":"<ul> <li>Calibration Module with NLopt integration</li> <li>BOBYQA, Nelder-Mead, DIRECT, COBYLA, CRS2, SBPLX algorithms</li> <li>Multi-stage calibration workflow (hydro \u2192 sediment \u2192 biogeo)</li> <li>Seasonal objective functions with time-series RMSE</li> <li> <p><code>seasonal_targets.csv</code> for dry/wet season calibration</p> </li> <li> <p>Greenhouse Gas Module</p> </li> <li>N\u2082O production from nitrification and denitrification</li> <li>CH\u2084 production, oxidation, and ebullition</li> <li> <p>Air-water gas exchange</p> </li> <li> <p>Flocculation Model</p> </li> <li>Salinity-dependent settling velocity</li> <li> <p>Estuarine Turbidity Maximum (ETM) formation</p> </li> <li> <p>Tropical Physics Enhancements</p> </li> <li>Salinity toxicity for freshwater phytoplankton</li> <li>Dynamic storage ratio RS(H)</li> <li>Manning's n friction option</li> <li> <p>Residual discharge filter</p> </li> <li> <p>Documentation</p> </li> <li>Full MkDocs Material theme setup</li> <li>Comprehensive user guide</li> <li>API reference</li> <li>Case studies (Mekong Delta)</li> </ul>"},{"location":"about/changelog/#changed","title":"Changed","text":"<ul> <li>Default test case changed from Tien_River to Mekong_Delta_Full</li> <li>Species count increased from 17 to 30</li> <li>Reaction count increased from 27 to 35+</li> <li>Build system updated to include NLopt library</li> </ul>"},{"location":"about/changelog/#fixed","title":"Fixed","text":"<ul> <li>Junction mass balance conservation</li> <li>Boundary condition interpolation edge cases</li> <li>Memory leaks in calibration module</li> </ul>"},{"location":"about/changelog/#090-2025-11-15","title":"[0.9.0] - 2025-11-15","text":""},{"location":"about/changelog/#added_1","title":"Added","text":"<ul> <li>C-RIVE biogeochemistry module</li> <li>2-step nitrification (NH\u2084 \u2192 NO\u2082 \u2192 NO\u2083)</li> <li>Carbonate chemistry (DIC, TA, pH, pCO\u2082)</li> <li>RK4 solver for biogeochemistry</li> </ul>"},{"location":"about/changelog/#080-2025-10-01","title":"[0.8.0] - 2025-10-01","text":""},{"location":"about/changelog/#added_2","title":"Added","text":"<ul> <li>Sediment erosion/deposition module</li> <li>SPM transport with settling</li> </ul>"},{"location":"about/changelog/#070-2025-09-01","title":"[0.7.0] - 2025-09-01","text":""},{"location":"about/changelog/#added_3","title":"Added","text":"<ul> <li>Multi-branch network topology</li> <li>Junction iteration solver</li> <li>CSV output for each branch</li> </ul>"},{"location":"about/changelog/#060-2025-08-01","title":"[0.6.0] - 2025-08-01","text":""},{"location":"about/changelog/#added_4","title":"Added","text":"<ul> <li>TVD advection schemes (Superbee limiter)</li> <li>Van den Burgh tidal dispersion</li> </ul>"},{"location":"about/changelog/#050-2025-07-01","title":"[0.5.0] - 2025-07-01","text":""},{"location":"about/changelog/#added_5","title":"Added","text":"<ul> <li>Saint-Venant hydrodynamics</li> <li>Staggered grid implementation</li> <li>Implicit time stepping</li> </ul>"},{"location":"about/changelog/#010-2025-06-01","title":"[0.1.0] - 2025-06-01","text":""},{"location":"about/changelog/#added_6","title":"Added","text":"<ul> <li>Initial project structure</li> <li>Basic data structures (Branch, Node, Network)</li> <li>Configuration file parsing</li> </ul>"},{"location":"about/citation/","title":"Citation","text":""},{"location":"about/citation/#citing-c-gem-network","title":"Citing C-GEM Network","text":"<p>If you use C-GEM Network in your research, please cite:</p> <pre><code>@software{cgem_network_2025,\n  title = {{C-GEM Network}: Carbon-Generic Estuary Model for Multi-Branch Networks},\n  author = {Nguyen, Truong and {Nguyen Truong An}},\n  year = {2025},\n  url = {https://github.com/nguytruonganlab/CGEM_network},\n  version = {1.0}\n}\n</code></pre>"},{"location":"about/citation/#related-publications","title":"Related Publications","text":""},{"location":"about/citation/#c-rive-biogeochemistry","title":"C-RIVE Biogeochemistry","text":"<p>For the biogeochemistry module:</p> <pre><code>@article{wang2018crive,\n  title = {Time-dependent global sensitivity analysis of the {C-RIVE} biogeochemical model},\n  author = {Wang, Shuaitao and Flipo, Nicolas and Romary, Thomas},\n  journal = {Water Research},\n  volume = {144},\n  pages = {341--355},\n  year = {2018},\n  doi = {10.1016/j.watres.2018.07.025}\n}\n\n@article{hasanyar2022unified,\n  title = {Unified {RIVE} v1.0: a multi-environment aquatic biogeochemical model},\n  author = {Shuaitao Wang, Vincent Thieu, Gilles Billen, Josette Garnier, Marie Silvestre, Audrey Marescaux, Xingcheng Yan, and Nicolas Flipo},\n  journal = {Biogeosciences},\n  year = {2022},\n  doi = {10.5194/bg-2022-XXX}\n}\n</code></pre>"},{"location":"about/citation/#savenijes-estuarine-theory","title":"Savenije's Estuarine Theory","text":"<p>For hydrodynamics and salinity intrusion:</p> <pre><code>@book{savenije2005salinity,\n  title = {Salinity and Tides in Alluvial Estuaries},\n  author = {Savenije, Hubert H.G.},\n  year = {2005},\n  publisher = {Elsevier},\n  isbn = {978-0-444-52107-1}\n}\n\n@article{nguyen2008salt,\n  title = {Using salt intrusion measurements to determine the freshwater discharge distribution over the branches of a multi-channel estuary: The Mekong Delta case},\n  author = {Nguyen, A.D. and Savenije, H.H.G. and Pham, D.N. and Tang, D.T.},\n  journal = {Estuarine, Coastal and Shelf Science},\n  volume = {77},\n  number = {3},\n  pages = {433--445},\n  year = {2008},\n  doi = {10.1016/j.ecss.2007.10.010}\n}\n</code></pre>"},{"location":"about/citation/#transport-and-dispersion","title":"Transport and Dispersion","text":"<pre><code>@article{vandenburgh1972dispersion,\n  title = {Analytical studies on salt intrusion in estuaries},\n  author = {Van den Burgh, P.},\n  year = {1972}\n}\n</code></pre>"},{"location":"about/citation/#acknowledgments","title":"Acknowledgments","text":"<p>C-GEM Network development has been supported by:</p> <ul> <li>[xxxxxx institutions]</li> </ul> <p>The biogeochemistry module is based on C-RIVE, developed by the METIS team (Sorbonne Universit\u00e9, CNRS).</p>"},{"location":"about/license/","title":"License","text":""},{"location":"about/license/#mit-license","title":"MIT License","text":"<p>Copyright \u00a9 2024-2025 Nguyen Truong An</p> <p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p> <p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p> <p>THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>"},{"location":"about/license/#third-party-licenses","title":"Third-Party Licenses","text":""},{"location":"about/license/#nlopt","title":"NLopt","text":"<p>NLopt is distributed under the GNU Lesser General Public License (LGPL). See https://github.com/stevengj/nlopt for details.</p>"},{"location":"about/license/#c-rive-biogeochemistry","title":"C-RIVE Biogeochemistry","text":"<p>The C-RIVE module is based on the Unified RIVE v1.0 model developed at Mines Paris. Original authors: N. Flipo, S. Wang, L. Vilmin, M. Hasanyar.</p>"},{"location":"api/biogeochemistry/","title":"Biogeochemistry API","text":""},{"location":"api/biogeochemistry/#main-driver","title":"Main Driver","text":""},{"location":"api/biogeochemistry/#biogeo_branch","title":"Biogeo_Branch","text":"<p>Main biogeochemistry driver for a branch.</p> <pre><code>int Biogeo_Branch(Branch *b, double dt);\n</code></pre> <p>Calls all sub-modules: 1. Phytoplankton growth/mortality 2. Nutrient uptake/regeneration 3. Oxygen dynamics 4. Carbonate chemistry 5. GHG production</p>"},{"location":"api/biogeochemistry/#phytoplankton","title":"Phytoplankton","text":""},{"location":"api/biogeochemistry/#rive_calc_phytoplankton","title":"rive_calc_phytoplankton","text":"<p>Calculate phytoplankton dynamics.</p> <pre><code>void rive_calc_phytoplankton(\n    Branch *b, int i,\n    double *gpp1, double *gpp2,\n    double *npp1, double *npp2,\n    double *mort1, double *mort2\n);\n</code></pre>"},{"location":"api/biogeochemistry/#rive_temp_kin","title":"rive_temp_kin","text":"<p>Temperature-dependent rate modifier.</p> <pre><code>double rive_temp_kin(int type, double k20, double temp);\n</code></pre> \\[k(T) = k_{20} \\cdot \\theta^{(T-20)}\\]"},{"location":"api/biogeochemistry/#nutrients","title":"Nutrients","text":""},{"location":"api/biogeochemistry/#rive_calc_nutrients","title":"rive_calc_nutrients","text":"<p>Calculate nutrient transformations.</p> <pre><code>void rive_calc_nutrients(\n    Branch *b, int i,\n    double *dNO3, double *dNH4, double *dPO4, double *dDSi,\n    double npp1, double npp2, double mort1, double mort2\n);\n</code></pre>"},{"location":"api/biogeochemistry/#oxygen","title":"Oxygen","text":""},{"location":"api/biogeochemistry/#rive_calc_oxygen","title":"rive_calc_oxygen","text":"<p>Calculate oxygen dynamics.</p> <pre><code>void rive_calc_oxygen(\n    Branch *b, int i,\n    double *dO2, double *o2_ex,\n    double gpp, double resp, double nit\n);\n</code></pre>"},{"location":"api/biogeochemistry/#calc_o2_saturation","title":"calc_o2_saturation","text":"<p>Calculate oxygen saturation.</p> <pre><code>double calc_o2_saturation(double temp, double sal);\n</code></pre>"},{"location":"api/biogeochemistry/#carbonate-chemistry","title":"Carbonate Chemistry","text":""},{"location":"api/biogeochemistry/#rive_calc_carbonate","title":"rive_calc_carbonate","text":"<p>Calculate carbonate system equilibrium.</p> <pre><code>void rive_calc_carbonate(\n    Branch *b, int i,\n    double *pH, double *pCO2, double *CO2aq\n);\n</code></pre>"},{"location":"api/biogeochemistry/#calc_co2_flux","title":"calc_co2_flux","text":"<p>Calculate CO2 air-water exchange.</p> <pre><code>double calc_co2_flux(double pCO2, double pCO2_atm, double kw, double K0);\n</code></pre>"},{"location":"api/biogeochemistry/#ghg-module","title":"GHG Module","text":""},{"location":"api/biogeochemistry/#rive_calc_n2o","title":"rive_calc_n2o","text":"<p>Calculate N2O production and emission.</p> <pre><code>void rive_calc_n2o(\n    Branch *b, int i,\n    double nit, double denit,\n    double *n2o_nit, double *n2o_denit, double *n2o_ex\n);\n</code></pre>"},{"location":"api/biogeochemistry/#rive_calc_ch4","title":"rive_calc_ch4","text":"<p>Calculate CH4 dynamics.</p> <pre><code>void rive_calc_ch4(\n    Branch *b, int i,\n    double *ch4_prod, double *ch4_ox, double *ch4_ex\n);\n</code></pre>"},{"location":"api/biogeochemistry/#sediment","title":"Sediment","text":""},{"location":"api/biogeochemistry/#sediment_branch","title":"Sediment_Branch","text":"<p>Calculate erosion and deposition.</p> <pre><code>int Sediment_Branch(Branch *b, double dt);\n</code></pre>"},{"location":"api/biogeochemistry/#calc_settling_velocity","title":"calc_settling_velocity","text":"<p>Flocculation-enhanced settling.</p> <pre><code>double calc_settling_velocity(double sal, BiogeoParams *params);\n</code></pre> \\[w_s = w_{s,0} \\cdot \\left(1 + (f_{max}-1) \\cdot \\tanh(S/S_{scale})\\right)\\]"},{"location":"api/biogeochemistry/#rk4-solver","title":"RK4 Solver","text":""},{"location":"api/biogeochemistry/#rk4_step","title":"rk4_step","text":"<p>Runge-Kutta 4<sup>th</sup> order step.</p> <pre><code>void rk4_step(\n    double *y, int n,\n    double (*f)(double*, void*), void *params,\n    double dt\n);\n</code></pre>"},{"location":"api/calibration/","title":"Calibration API","text":""},{"location":"api/calibration/#data-structures","title":"Data Structures","text":""},{"location":"api/calibration/#calibrationengine","title":"CalibrationEngine","text":"<pre><code>typedef struct {\n    CalibParam *params;\n    int num_params;\n    int active_params;          // Parameters for current stage\n\n    CalibObjective *objectives;\n    int num_objectives;\n\n    // Seasonal objectives\n    CalibObjective *seasonal_objs;\n    int num_seasonal_objs;\n\n    // State\n    int current_stage;\n    int max_iterations;\n    double tolerance;\n\n    // Results\n    double best_rmse;\n    double *best_params;\n    int num_evaluations;\n} CalibrationEngine;\n</code></pre>"},{"location":"api/calibration/#calibparam","title":"CalibParam","text":"<pre><code>typedef struct {\n    char name[64];\n\n    // Target\n    TargetType target_type;     // GLOBAL or BRANCH\n    char target_id[64];         // Branch name or \"-\"\n\n    // Variable\n    VarType var_type;           // CHEZY, VDB_COEF, WS, etc.\n\n    // Bounds\n    double min_val;\n    double max_val;\n    double initial;\n    double current;\n    double best;\n\n    // Stage\n    int stage;\n} CalibParam;\n</code></pre>"},{"location":"api/calibration/#calibobjective","title":"CalibObjective","text":"<pre><code>typedef struct {\n    char branch_name[64];\n    int branch_idx;\n\n    // Variable\n    char variable[32];\n    int species_idx;\n\n    // Type\n    StatisticType stat_type;    // MEAN, MIN, MAX, INTRUSION_LEN, ETM_LOC\n    double target_value;\n    double weight;\n    double threshold;           // For intrusion length\n\n    // Seasonal (NEW)\n    double location_km;         // Location for point observation\n    double *obs_time;           // Observation times [days]\n    double *obs_value;          // Observation values\n    int num_obs;                // Number of observations\n    int use_seasonal;           // 1 = use time-series RMSE\n} CalibObjective;\n</code></pre>"},{"location":"api/calibration/#main-functions","title":"Main Functions","text":""},{"location":"api/calibration/#calib_init","title":"calib_init","text":"<p>Initialize calibration engine.</p> <pre><code>CalibrationEngine *calib_init(const char *case_dir);\n</code></pre>"},{"location":"api/calibration/#calib_load_params","title":"calib_load_params","text":"<p>Load parameters from CSV.</p> <pre><code>int calib_load_params(CalibrationEngine *engine, const char *filepath);\n</code></pre>"},{"location":"api/calibration/#calib_load_objectives","title":"calib_load_objectives","text":"<p>Load objectives from CSV.</p> <pre><code>int calib_load_objectives(CalibrationEngine *engine, const char *filepath);\n</code></pre>"},{"location":"api/calibration/#calib_load_seasonal_targets","title":"calib_load_seasonal_targets","text":"<p>Load seasonal observations.</p> <pre><code>int calib_load_seasonal_targets(CalibrationEngine *engine, const char *filepath);\n</code></pre>"},{"location":"api/calibration/#calib_run_optimization","title":"calib_run_optimization","text":"<p>Run NLopt optimization.</p> <pre><code>double calib_run_optimization(\n    CalibrationEngine *engine,\n    Network *network,\n    CaseConfig *config\n);\n</code></pre> <p>Returns: Best RMSE achieved</p>"},{"location":"api/calibration/#calib_calculate_objective","title":"calib_calculate_objective","text":"<p>Calculate total objective function.</p> <pre><code>double calib_calculate_objective(\n    CalibrationEngine *engine,\n    Network *network\n);\n</code></pre>"},{"location":"api/calibration/#calib_calc_seasonal_rmse","title":"calib_calc_seasonal_rmse","text":"<p>Calculate RMSE for seasonal objective.</p> <pre><code>double calib_calc_seasonal_rmse(\n    CalibrationEngine *engine,\n    CalibObjective *obj,\n    Network *network\n);\n</code></pre>"},{"location":"api/calibration/#calib_apply_params_to_network","title":"calib_apply_params_to_network","text":"<p>Apply current parameters to network.</p> <pre><code>void calib_apply_params_to_network(\n    CalibrationEngine *engine,\n    Network *network\n);\n</code></pre>"},{"location":"api/calibration/#calib_save_results","title":"calib_save_results","text":"<p>Save calibration results.</p> <pre><code>int calib_save_results(\n    CalibrationEngine *engine,\n    const char *output_dir\n);\n</code></pre>"},{"location":"api/calibration/#calib_free","title":"calib_free","text":"<p>Free calibration engine.</p> <pre><code>void calib_free(CalibrationEngine *engine);\n</code></pre>"},{"location":"api/calibration/#nlopt-integration","title":"NLopt Integration","text":""},{"location":"api/calibration/#nlopt_objective_wrapper","title":"nlopt_objective_wrapper","text":"<p>Wrapper for NLopt objective function.</p> <pre><code>double nlopt_objective_wrapper(\n    unsigned n,\n    const double *x,\n    double *grad,\n    void *data\n);\n</code></pre>"},{"location":"api/calibration/#supported-algorithms","title":"Supported Algorithms","text":"ID NLopt Algorithm Description 0 <code>NLOPT_LN_NELDERMEAD</code> Nelder-Mead simplex 1 <code>NLOPT_LN_BOBYQA</code> BOBYQA (default) 2 <code>NLOPT_GN_DIRECT</code> DIRECT global 3 <code>NLOPT_LN_COBYLA</code> COBYLA constrained 4 <code>NLOPT_GN_CRS2_LM</code> CRS2 random search 5 <code>NLOPT_LN_SBPLX</code> Subplex"},{"location":"api/calibration/#example-usage","title":"Example Usage","text":"<pre><code>// Initialize\nCalibrationEngine *engine = calib_init(case_dir);\n\n// Load configuration\ncalib_load_params(engine, \"calibration_params.csv\");\ncalib_load_objectives(engine, \"calibration_targets.csv\");\ncalib_load_seasonal_targets(engine, \"seasonal_targets.csv\");\n\n// Set stage\nengine-&gt;current_stage = 1;\n\n// Run optimization\ndouble best_rmse = calib_run_optimization(engine, network, config);\n\n// Save results\ncalib_save_results(engine, output_dir);\n\n// Cleanup\ncalib_free(engine);\n</code></pre>"},{"location":"api/hydrodynamics/","title":"Hydrodynamics API","text":""},{"location":"api/hydrodynamics/#main-functions","title":"Main Functions","text":""},{"location":"api/hydrodynamics/#hyd_branch","title":"Hyd_Branch","text":"<p>Solve Saint-Venant equations for a single branch.</p> <pre><code>int Hyd_Branch(Branch *b, double H_down, double H_up, double Q_up, double dt);\n</code></pre> <p>Parameters: - <code>b</code>: Branch pointer - <code>H_down</code>: Water level at downstream boundary [m] - <code>H_up</code>: Water level at upstream boundary [m] - <code>Q_up</code>: Discharge at upstream boundary [m\u00b3/s] - <code>dt</code>: Time step [s]</p> <p>Returns: 0 on success, -1 on error</p>"},{"location":"api/hydrodynamics/#solve_network_hydro","title":"solve_network_hydro","text":"<p>Solve hydrodynamics for entire network with junction iteration.</p> <pre><code>int solve_network_hydro(Network *net, double dt, int max_iter, double tol);\n</code></pre> <p>Parameters: - <code>net</code>: Network pointer - <code>dt</code>: Time step [s] - <code>max_iter</code>: Maximum junction iterations - <code>tol</code>: Convergence tolerance</p> <p>Returns: 0 on success, number of non-converged junctions on failure</p>"},{"location":"api/hydrodynamics/#geometry-functions","title":"Geometry Functions","text":""},{"location":"api/hydrodynamics/#calc_width","title":"calc_width","text":"<p>Calculate channel width at position x.</p> <pre><code>double calc_width(Branch *b, double x);\n</code></pre> <p>Exponential geometry: \\(\\(B(x) = B_0 \\exp(-x/L_c)\\)\\)</p>"},{"location":"api/hydrodynamics/#calc_area","title":"calc_area","text":"<p>Calculate cross-sectional area.</p> <pre><code>double calc_area(Branch *b, int i);\n</code></pre> \\[A = B \\cdot H\\]"},{"location":"api/hydrodynamics/#calc_hydraulic_radius","title":"calc_hydraulic_radius","text":"<p>Calculate hydraulic radius.</p> <pre><code>double calc_hydraulic_radius(Branch *b, int i);\n</code></pre> <p>\\(\\(R = A / B \\approx H\\)\\) (for wide channels)</p>"},{"location":"api/hydrodynamics/#friction","title":"Friction","text":""},{"location":"api/hydrodynamics/#calc_friction_slope","title":"calc_friction_slope","text":"<p>Calculate friction slope using Chezy or Manning.</p> <pre><code>double calc_friction_slope(Branch *b, int i);\n</code></pre> <p>Chezy: \\(\\(S_f = \\frac{U|U|}{C^2 R}\\)\\)</p> <p>Manning: \\(\\(S_f = \\frac{n^2 U|U|}{R^{4/3}}\\)\\)</p>"},{"location":"api/hydrodynamics/#solver","title":"Solver","text":""},{"location":"api/hydrodynamics/#solve_tridiagonal","title":"solve_tridiagonal","text":"<p>Thomas algorithm for tridiagonal systems.</p> <pre><code>void solve_tridiagonal(double *a, double *b, double *c, double *d, double *x, int n);\n</code></pre> <p>Solves: \\(a_i x_{i-1} + b_i x_i + c_i x_{i+1} = d_i\\)</p>"},{"location":"api/structures/","title":"Core Data Structures","text":""},{"location":"api/structures/#network","title":"Network","text":"<p>The top-level container for all simulation data.</p> <pre><code>typedef struct {\n    Branch **branches;          // Array of branch pointers\n    Node *nodes;                // Array of nodes\n    size_t num_branches;\n    size_t num_nodes;\n    int num_species;\n\n    // Simulation parameters\n    double dt;                  // Time step [s]\n    double dx_target;           // Target grid spacing [m]\n    double total_time;          // Total simulation time [s]\n    double warmup_time;         // Warmup period [s]\n\n    // Forcing\n    double tidal_amplitude;\n    double Q_river;\n} Network;\n</code></pre>"},{"location":"api/structures/#branch","title":"Branch","text":"<p>Represents a river reach with M grid cells.</p> <pre><code>typedef struct {\n    // Identity\n    int id;\n    char name[64];\n    int node_up, node_down;\n\n    // Geometry\n    double length_m;\n    double width_down_m, width_up_m;\n    double depth_m;\n    double chezy;\n    double lc_convergence;      // Exponential convergence length [m]\n    double vdb_coef;            // Van den Burgh coefficient\n    double rs;                  // Storage width ratio\n\n    // Grid\n    int M;                      // Number of cells\n    double dx;                  // Cell size [m]\n\n    // State arrays [0..M+1] (includes ghost cells)\n    double *depth;\n    double *velocity;\n    double *waterLevel;\n    double *totalArea;\n    double *width;\n    double *dispersion;\n\n    // Species [num_species][0..M+1]\n    double **conc;\n\n    // Reactions [num_reactions][0..M+1]\n    double **reaction_rates;\n\n    // Biogeochemistry parameters\n    BiogeoParams *biogeo;\n\n    // Tridiagonal solver workspace\n    double *tri_lower, *tri_diag, *tri_upper, *tri_rhs;\n} Branch;\n</code></pre>"},{"location":"api/structures/#node","title":"Node","text":"<p>Connection point in the network.</p> <pre><code>typedef enum {\n    NODE_JUNCTION,\n    NODE_DISCHARGE_BC,\n    NODE_LEVEL_BC\n} NodeType;\n\ntypedef struct {\n    int id;\n    NodeType type;\n\n    // State\n    double H, H_new;            // Water level [m]\n    double Q_net;               // Net discharge [m\u00b3/s]\n\n    // Connectivity\n    int *connected_branches;\n    int *connection_dir;        // +1 = outflow, -1 = inflow\n    int num_connections;\n\n    // Forcing\n    double *forcing_time;\n    double *forcing_value;\n    int forcing_len;\n\n    // Species forcing\n    double **species_forcing_time;\n    double **species_forcing_value;\n    int *species_forcing_len;\n\n    // Species mixing\n    double *mixed_conc;\n} Node;\n</code></pre>"},{"location":"api/structures/#caseconfig","title":"CaseConfig","text":"<p>Simulation configuration.</p> <pre><code>typedef struct {\n    char case_name[256];\n    char output_dir[512];\n\n    // Time\n    double duration;            // [days]\n    double warmup;              // [days]\n    double dt;                  // [s]\n\n    // Numerics\n    double dx_target;           // [m]\n\n    // Output\n    int write_csv;\n    int write_netcdf;\n    int write_reactions;\n\n    // Calibration\n    int calibration_mode;\n    int calibration_stage;\n    int max_iterations;\n} CaseConfig;\n</code></pre>"},{"location":"api/structures/#biogeoparams","title":"BiogeoParams","text":"<p>Biogeochemistry parameters.</p> <pre><code>typedef struct {\n    // Phytoplankton\n    double pbmax1, pbmax2;      // Max photosynthesis rate [d-1]\n    double kmort1, kmort2;      // Mortality rate [d-1]\n    double kn, kp, ksi;         // Half-saturation constants\n\n    // Bacteria\n    double kox;                 // Aerobic degradation [d-1]\n    double knit;                // Nitrification [d-1]\n    double kdenit;              // Denitrification [d-1]\n\n    // Oxygen\n    double ko2;                 // O2 half-saturation [\u00b5mol/L]\n\n    // Sediment\n    double ws_base;             // Base settling velocity [m/s]\n    double tau_ero;             // Critical erosion stress [Pa]\n    double tau_dep;             // Critical deposition stress [Pa]\n    double floc_sal_scale;      // Flocculation salinity scale [PSU]\n    double floc_factor_max;     // Max flocculation factor [-]\n\n    // Salinity stress\n    double sal_stress_thresh;   // Stress onset [PSU]\n    double sal_stress_coef;     // Mortality enhancement [-]\n} BiogeoParams;\n</code></pre>"},{"location":"api/structures/#memory-management","title":"Memory Management","text":""},{"location":"api/structures/#allocation","title":"Allocation","text":"<pre><code>Branch *allocate_branch(int M, int num_species, int num_reactions);\nNode *allocate_node(int num_species);\nNetwork *allocate_network(int num_branches, int num_nodes, int num_species);\n</code></pre>"},{"location":"api/structures/#deallocation","title":"Deallocation","text":"<pre><code>void free_branch(Branch *b);\nvoid free_node(Node *n);\nvoid free_network(Network *net);\n</code></pre>"},{"location":"api/transport/","title":"Transport API","text":""},{"location":"api/transport/#main-functions","title":"Main Functions","text":""},{"location":"api/transport/#transport_branch","title":"Transport_Branch","text":"<p>Solve advection-dispersion for a species on one branch.</p> <pre><code>int Transport_Branch(Branch *b, int species, double dt, double C_up, double C_down);\n</code></pre> <p>Parameters: - <code>b</code>: Branch pointer - <code>species</code>: Species index (from <code>define.h</code>) - <code>dt</code>: Time step [s] - <code>C_up</code>: Upstream boundary concentration - <code>C_down</code>: Downstream boundary concentration</p> <p>Returns: 0 on success, -1 on error</p>"},{"location":"api/transport/#transport_all_species","title":"transport_all_species","text":"<p>Transport all species for a branch.</p> <pre><code>int transport_all_species(Branch *b, double dt, double *C_up, double *C_down, int num_species);\n</code></pre>"},{"location":"api/transport/#tvd-schemes","title":"TVD Schemes","text":""},{"location":"api/transport/#calc_flux_limiter","title":"calc_flux_limiter","text":"<p>Calculate flux limiter for TVD schemes.</p> <pre><code>double calc_flux_limiter(double r, int limiter_type);\n</code></pre> <p>Limiter types: - 0: Minmod - 1: Superbee (default) - 2: Van Leer - 3: MC</p> <p>Superbee: \\(\\(\\phi(r) = \\max(0, \\min(2r, 1), \\min(r, 2))\\)\\)</p>"},{"location":"api/transport/#calc_advective_flux","title":"calc_advective_flux","text":"<p>Calculate advective flux with TVD limiter.</p> <pre><code>double calc_advective_flux(Branch *b, int species, int i, int limiter);\n</code></pre>"},{"location":"api/transport/#dispersion","title":"Dispersion","text":""},{"location":"api/transport/#calc_dispersion_coefficient","title":"calc_dispersion_coefficient","text":"<p>Calculate Van den Burgh dispersion.</p> <pre><code>double calc_dispersion_coefficient(Branch *b, int i);\n</code></pre> \\[K = K_0 + K_{VDB} \\cdot U \\cdot A\\]"},{"location":"api/transport/#update_dispersion_field","title":"update_dispersion_field","text":"<p>Update dispersion for entire branch.</p> <pre><code>void update_dispersion_field(Branch *b);\n</code></pre>"},{"location":"cases/mekong-delta/","title":"Mekong Delta Case Study","text":""},{"location":"cases/mekong-delta/#overview","title":"Overview","text":"<p>The Mekong Delta Full case (<code>Mekong_Delta_Full</code>) demonstrates C-GEM's capabilities for a complete multi-branch estuarine network.</p>"},{"location":"cases/mekong-delta/#network-structure","title":"Network Structure","text":"<ul> <li>9 branches: Main rivers and distributaries</li> <li>10 nodes: 2 upstream (discharge), 4 ocean (tidal), 4 junctions</li> <li>Total length: ~450 km of channels</li> <li>Grid: 2 km resolution, ~225 cells total</li> </ul> <pre><code>                 Tien River (Q)           Hau River (Q)\n                      \u2502                        \u2502\n                      \u25bc                        \u25bc\n                 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                 \u2502Tien Main\u2502              \u2502Hau Main \u2502\n                 \u2502 48 km   \u2502              \u2502 44 km   \u2502\n                 \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518              \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518\n                      \u2502                        \u2502\n                      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                 \u2502\n                            \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510\n                            \u2502 Vam Nao \u2502\n                            \u2502  8 km   \u2502\n                            \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518\n                                 \u2502\n              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n              \u2502                  \u2502                 \u2502\n         \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2510       \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510       \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510\n         \u2502Tien Lower\u2502       \u2502Tien Conn\u2502       \u2502         \u2502\n         \u2502  48 km   \u2502       \u2502  16 km  \u2502       \u2502         \u2502\n         \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518       \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518       \u2502         \u2502\n              \u2502                  \u2502            \u2502         \u2502\n    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502            \u2502         \u2502\n    \u2502         \u2502         \u2502        \u2502            \u2502         \u2502\n\u250c\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2510     \u2502   \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502Co     \u2502 \u2502My Tho \u2502     \u2502   \u2502Ham Luong\u2502  \u2502Hau River\u2502    \u2502\n\u2502Chien  \u2502 \u2502 56 km \u2502     \u2502   \u2502  60 km  \u2502  \u2502  88 km  \u2502    \u2502\n\u2502 84 km \u2502 \u2514\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2518     \u2502   \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2514\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2518     \u2502         \u2502        \u2502            \u2502         \u2502\n    \u2502         \u2502         \u2502        \u2502            \u2502         \u2502\n    \u25bc         \u25bc         \u25bc        \u25bc            \u25bc         \u25bc\n  Ocean     Ocean     Ocean    Ocean        Ocean     Ocean\n</code></pre>"},{"location":"cases/mekong-delta/#configuration","title":"Configuration","text":""},{"location":"cases/mekong-delta/#case_configtxt","title":"case_config.txt","text":"<pre><code>CaseName = Mekong_Delta_Full\n\n# Files\nTopology = topology.csv\nBoundaryMap = boundary_map.csv\nBiogeoParams = biogeo_params.txt\nOutputDir = OUTPUT/Mekong_Delta_Full\n\n# Time\nStartDate = 2024-03-01\nDuration = 30\nWarmup = 10\n\n# Numerics\nTimeStep = 300.0\nDELXI = 2000.0\n\n# Output\nWriteCSV = 1\n</code></pre>"},{"location":"cases/mekong-delta/#topologycsv","title":"topology.csv","text":"<pre><code>BranchID,BranchName,NodeUp,NodeDown,Length_m,Width_Down_m,Width_Up_m,Depth_m,Chezy,RS\n1,Tien_Main,1,3,48000,1200,1000,15,55,1.0\n2,Hau_Main,2,3,44000,1100,900,14,55,1.0\n3,Vam_Nao,3,4,8000,600,600,18,65,1.0\n4,Tien_Lower,4,10,48000,1400,1200,14,55,1.0\n5,Tien_Connector,10,5,16000,1200,1100,13,55,1.0\n6,Co_Chien,10,6,84000,2800,1100,13,50,1.2\n7,My_Tho,5,7,56000,2200,900,11,50,1.2\n8,Ham_Luong,5,8,60000,2500,1000,12,50,1.2\n9,Hau_River,4,9,88000,3000,1200,14,50,1.3\n</code></pre>"},{"location":"cases/mekong-delta/#boundary-conditions","title":"Boundary Conditions","text":"<p>Upstream (Discharge): - Node 1: Tien River inflow (Q from MRC data) - Node 2: Hau River inflow (Q from MRC data)</p> <p>Downstream (Tidal Level): - Node 6: Co Chien mouth (M2 + S2 tides) - Node 7: My Tho mouth - Node 8: Ham Luong mouth - Node 9: Hau River mouth</p>"},{"location":"cases/mekong-delta/#running-the-case","title":"Running the Case","text":""},{"location":"cases/mekong-delta/#standard-simulation","title":"Standard Simulation","text":"<pre><code>.\\bin\\Debug\\CGEM_Network.exe INPUT/Cases/Mekong_Delta_Full/case_config.txt\n</code></pre> <p>Output: <pre><code>==============================================\n  C-GEM Network Engine\n==============================================\n  Case        : Mekong_Delta_Full\n  Branches    : 9\n  Nodes       : 10\n  Species     : 30\n  Time step   : 300.0 s\n  Duration    : 30 days\n  Warmup      : 10 days\n==============================================\n\nDay    1.0 (  3.3%) [WARMUP] | H=15.40 m, U=0.142 m/s, S=0.1 | 2.4 s elapsed\nDay   10.0 ( 33.3%)          | H=15.39 m, U=0.173 m/s, S=11.4 | 22.4 s elapsed\n...\nSimulation complete: 8640 steps in 76.6 seconds (112.8 steps/s)\n</code></pre></p>"},{"location":"cases/mekong-delta/#with-calibration","title":"With Calibration","text":"<pre><code>.\\bin\\Debug\\CGEM_Network.exe INPUT/Cases/Mekong_Delta_Full/case_config.txt --calibrate --stage 1 --max-iter 50\n</code></pre>"},{"location":"cases/mekong-delta/#results","title":"Results","text":""},{"location":"cases/mekong-delta/#salinity-intrusion","title":"Salinity Intrusion","text":"<p>During dry season (low discharge):</p> Branch Intrusion Length (4 PSU) Observed Ham Luong 55-60 km 50-65 km Co Chien 45-50 km 40-55 km Hau River 60-70 km 55-75 km"},{"location":"cases/mekong-delta/#tidal-range","title":"Tidal Range","text":"Location Model Observed Can Tho 2.0-2.5 m 2.0-2.8 m My Tho 2.5-3.0 m 2.2-3.2 m"},{"location":"cases/mekong-delta/#typical-output","title":"Typical Output","text":"<pre><code>time_days,depth_x1,depth_x10,salinity_x1,salinity_x10,salinity_x30,...\n0.0,15.2,14.8,32.5,28.3,12.1,...\n0.042,15.5,15.0,32.8,29.1,13.2,...\n0.083,15.1,14.5,31.9,27.5,11.8,...\n...\n</code></pre>"},{"location":"cases/mekong-delta/#seasonal-calibration","title":"Seasonal Calibration","text":"<p>The Mekong has strong seasonal variation:</p> <ul> <li>Dry season (Dec-Apr): Low discharge, maximum salinity intrusion</li> <li>Wet season (Jun-Oct): High discharge, minimal intrusion</li> </ul>"},{"location":"cases/mekong-delta/#seasonal_targetscsv","title":"seasonal_targets.csv","text":"<pre><code>Branch,Variable,Location_km,Time_Day,Value,Weight\n# Dry season peak (mid-March)\nHam_Luong,SALINITY,30.0,15.0,25.0,2.0\nHam_Luong,SALINITY,40.0,15.0,15.0,2.0\nHam_Luong,SALINITY,50.0,15.0,6.0,2.0\n\n# Wet season (August)\nHam_Luong,SALINITY,20.0,180.0,0.5,1.0\nHam_Luong,SALINITY,30.0,180.0,0.1,1.0\n</code></pre>"},{"location":"cases/mekong-delta/#running-seasonal-calibration","title":"Running Seasonal Calibration","text":"<pre><code>.\\bin\\Debug\\CGEM_Network.exe INPUT/Cases/Mekong_Delta_Full/case_config.txt --calibrate\n</code></pre> <p>The optimizer will find parameters that satisfy both dry and wet season observations.</p>"},{"location":"cases/mekong-delta/#visualization","title":"Visualization","text":""},{"location":"cases/mekong-delta/#python-script","title":"Python Script","text":"<pre><code>import pandas as pd\nimport matplotlib.pyplot as plt\nimport numpy as np\n\n# Load branch outputs\nbranches = ['Ham_Luong', 'Co_Chien', 'My_Tho', 'Hau_River']\nfig, axes = plt.subplots(2, 2, figsize=(14, 10))\n\nfor ax, branch in zip(axes.flat, branches):\n    df = pd.read_csv(f'OUTPUT/Mekong_Delta_Full/CSV/{branch}.csv')\n\n    # Plot salinity at different distances\n    for x in [10, 30, 50]:\n        col = f'salinity_x{x}'\n        if col in df.columns:\n            ax.plot(df['time_days'], df[col], label=f'{x} km')\n\n    ax.set_xlabel('Time (days)')\n    ax.set_ylabel('Salinity (PSU)')\n    ax.set_title(branch)\n    ax.legend()\n    ax.grid(True, alpha=0.3)\n\nplt.tight_layout()\nplt.savefig('mekong_salinity.png', dpi=150)\nplt.show()\n</code></pre>"},{"location":"cases/mekong-delta/#references","title":"References","text":"<ol> <li> <p>Nguyen, A.D., Savenije, H.H.G., Pham, D.N., Tang, D.T. (2008). Using salt intrusion measurements to determine the freshwater discharge distribution over the branches of a multi-channel estuary: The Mekong Delta case. Estuarine, Coastal and Shelf Science, 77(3), 433-445.</p> </li> <li> <p>Renaud, F.G., Kuenzer, C. (2012). The Mekong Delta System. Springer.</p> </li> <li> <p>MRC (Mekong River Commission). Hydrological data and monitoring.</p> </li> </ol>"},{"location":"cases/tien-river/","title":"Tien River Case Study","text":""},{"location":"cases/tien-river/#overview","title":"Overview","text":"<p>The Tien River case (<code>Tien_River</code>) is a simplified test case for validating C-GEM's multi-branch functionality.</p>"},{"location":"cases/tien-river/#network-structure","title":"Network Structure","text":"<ul> <li>5 branches</li> <li>6 nodes</li> <li>Single bifurcation point</li> </ul> <pre><code>          Upstream (Q)\n              \u2502\n              \u25bc\n         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n         \u2502  Tien   \u2502\n         \u2502  Main   \u2502\n         \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518\n              \u2502\n         \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510\n         \u2502   Bi-   \u2502\n         \u2502furcation\u2502\n         \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518\n              \u2502\n    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    \u2502         \u2502         \u2502\n    \u25bc         \u25bc         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502Branch \u2502 \u2502Branch \u2502 \u2502Branch \u2502\n\u2502  A    \u2502 \u2502   B   \u2502 \u2502   C   \u2502\n\u2514\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2518\n    \u2502         \u2502         \u2502\n    \u25bc         \u25bc         \u25bc\n  Ocean     Ocean     Ocean\n</code></pre>"},{"location":"cases/tien-river/#running-the-case","title":"Running the Case","text":"<pre><code>.\\bin\\Debug\\CGEM_Network.exe INPUT/Cases/Tien_River/case_config.txt\n</code></pre>"},{"location":"cases/tien-river/#use-case","title":"Use Case","text":"<p>The Tien River case is ideal for:</p> <ol> <li>Testing new features - Simpler than full Mekong</li> <li>Debugging - Faster runtime</li> <li>Learning - Understand model behavior</li> <li>Validation - Compare with analytical solutions</li> </ol>"},{"location":"cases/tien-river/#expected-results","title":"Expected Results","text":"<ul> <li>Tidal propagation upstream</li> <li>Salt intrusion during low discharge</li> <li>Junction mass balance conservation</li> </ul>"},{"location":"development/code-style/","title":"Code Style","text":""},{"location":"development/code-style/#general-principles","title":"General Principles","text":"<ol> <li>Readability over cleverness</li> <li>Config-driven \u2014 no hardcoded values</li> <li>Memory safety \u2014 allocate at init, free at shutdown</li> <li>Documentation \u2014 comment all functions</li> </ol>"},{"location":"development/code-style/#naming-conventions","title":"Naming Conventions","text":""},{"location":"development/code-style/#functions","title":"Functions","text":"<pre><code>// Module prefix + action + target\nint Hyd_Branch(Branch *b, ...);           // Hydrodynamics module\nint Transport_Branch(Branch *b, ...);     // Transport module\nint Biogeo_Branch(Branch *b, ...);        // Biogeochemistry module\n\n// Helper functions: lowercase with underscores\ndouble calc_bed_shear(Branch *b, int i);\nvoid solve_tridiagonal(double *a, double *b, double *c, double *d, int n);\n</code></pre>"},{"location":"development/code-style/#variables","title":"Variables","text":"<pre><code>// Local variables: lowercase with underscores\ndouble water_depth;\nint cell_index;\n\n// Loop indices: single letter\nfor (int i = 0; i &lt; n; i++) { }\n\n// Constants: UPPER_SNAKE_CASE\n#define MAX_SPECIES 50\n#define GRAVITY 9.81\n</code></pre>"},{"location":"development/code-style/#structs","title":"Structs","text":"<pre><code>// PascalCase for struct names\ntypedef struct {\n    int id;\n    char name[64];\n    double *depth;\n} Branch;\n\ntypedef struct {\n    Branch **branches;\n    size_t num_branches;\n} Network;\n</code></pre>"},{"location":"development/code-style/#file-organization","title":"File Organization","text":"<pre><code>/**\n * @file module_name.c\n * @brief Brief description\n */\n\n#include \"module_name.h\"\n#include &lt;stdlib.h&gt;\n#include &lt;math.h&gt;\n\n/* Constants */\n#define LOCAL_CONST 1.0\n\n/* Static helper functions */\nstatic double helper_function(double x) {\n    return x * 2.0;\n}\n\n/* Public API functions */\nint Module_PublicFunction(Branch *b) {\n    // Implementation\n}\n</code></pre>"},{"location":"development/code-style/#documentation","title":"Documentation","text":""},{"location":"development/code-style/#function-headers","title":"Function Headers","text":"<pre><code>/**\n * @brief Calculate erosion rate based on shear stress\n * \n * Uses Partheniades formula for cohesive sediment erosion.\n * \n * @param tau Bed shear stress [Pa]\n * @param tau_crit Critical erosion stress [Pa]\n * @param M_ero Erosion coefficient [kg/m\u00b2/s]\n * @return Erosion rate [kg/m\u00b2/s], 0 if tau &lt; tau_crit\n * \n * @note Reference: Partheniades (1965)\n */\ndouble calc_erosion_rate(double tau, double tau_crit, double M_ero);\n</code></pre>"},{"location":"development/code-style/#memory-management","title":"Memory Management","text":""},{"location":"development/code-style/#allocation","title":"Allocation","text":"<pre><code>// Allocate at initialization\nBranch *allocate_branch(int M, int num_species) {\n    Branch *b = malloc(sizeof(Branch));\n    if (!b) return NULL;\n\n    b-&gt;depth = malloc((M + 2) * sizeof(double));\n    if (!b-&gt;depth) {\n        free(b);\n        return NULL;\n    }\n\n    return b;\n}\n</code></pre>"},{"location":"development/code-style/#deallocation","title":"Deallocation","text":"<pre><code>// Free at shutdown\nvoid free_branch(Branch *b) {\n    if (!b) return;\n\n    free(b-&gt;depth);\n    free(b-&gt;velocity);\n    // ... free all arrays\n\n    free(b);\n}\n</code></pre>"},{"location":"development/code-style/#rules","title":"Rules","text":"<ul> <li>Never <code>malloc</code> in time loops</li> <li>Always check return value of <code>malloc</code></li> <li>Set pointers to <code>NULL</code> after <code>free</code></li> <li>Use pre-allocated scratch arrays</li> </ul>"},{"location":"development/code-style/#error-handling","title":"Error Handling","text":"<pre><code>int some_function(Branch *b) {\n    if (!b) {\n        fprintf(stderr, \"Error: NULL branch pointer\\n\");\n        return -1;\n    }\n\n    if (b-&gt;M &lt;= 0) {\n        fprintf(stderr, \"Error: Invalid grid size M=%d\\n\", b-&gt;M);\n        return -1;\n    }\n\n    // ... computation\n\n    return 0;  // Success\n}\n</code></pre>"},{"location":"development/code-style/#loop-patterns","title":"Loop Patterns","text":""},{"location":"development/code-style/#grid-loops","title":"Grid Loops","text":"<pre><code>// Standard grid loop (1 to M, excluding ghost cells)\nfor (int i = 1; i &lt;= b-&gt;M; ++i) {\n    double val = b-&gt;conc[species][i];\n}\n\n// Include ghost cells\nfor (int i = 0; i &lt;= b-&gt;M + 1; ++i) {\n    // ...\n}\n</code></pre>"},{"location":"development/code-style/#species-loops","title":"Species Loops","text":"<pre><code>for (int s = 0; s &lt; net-&gt;num_species; ++s) {\n    Transport_Branch(b, s, dt, C_up[s], C_down[s]);\n}\n</code></pre>"},{"location":"development/code-style/#testing","title":"Testing","text":"<p>Before committing:</p> <ul> <li> Compiles without warnings</li> <li> Mekong_Delta_Full case runs successfully</li> <li> Calibration mode works</li> <li> Memory leak check (valgrind on Linux)</li> </ul>"},{"location":"development/contributing/","title":"Contributing","text":"<p>Thank you for your interest in contributing to C-GEM Network!</p>"},{"location":"development/contributing/#getting-started","title":"Getting Started","text":"<ol> <li>Fork the repository</li> <li>Clone your fork</li> <li>Create a feature branch</li> <li>Make your changes</li> <li>Submit a pull request</li> </ol>"},{"location":"development/contributing/#development-setup","title":"Development Setup","text":"<pre><code># Clone repository\ngit clone https://github.com/yourusername/CGEM_network.git\ncd CGEM_network\n\n# Build\n.\\scripts\\build.bat\n\n# Run tests\n.\\bin\\Debug\\CGEM_Network.exe INPUT/Cases/Mekong_Delta_Full/case_config.txt\n</code></pre>"},{"location":"development/contributing/#code-guidelines","title":"Code Guidelines","text":"<p>See Code Style for detailed guidelines.</p>"},{"location":"development/contributing/#summary","title":"Summary","text":"<ul> <li>Language: ANSI C (C11)</li> <li>Memory: Allocate at init, free at shutdown</li> <li>Config: No hardcoded values</li> <li>Documentation: Comment all functions</li> </ul>"},{"location":"development/contributing/#submitting-changes","title":"Submitting Changes","text":""},{"location":"development/contributing/#pull-request-process","title":"Pull Request Process","text":"<ol> <li>Update documentation if needed</li> <li>Add tests for new features</li> <li>Ensure build passes without warnings</li> <li>Update CHANGELOG.md</li> <li>Submit PR with clear description</li> </ol>"},{"location":"development/contributing/#commit-messages","title":"Commit Messages","text":"<pre><code>type(scope): brief description\n\nDetailed explanation if needed.\n\nReferences: #issue_number\n</code></pre> <p>Types: <code>feat</code>, <code>fix</code>, <code>docs</code>, <code>style</code>, <code>refactor</code>, <code>test</code>, <code>chore</code></p>"},{"location":"development/contributing/#reporting-issues","title":"Reporting Issues","text":"<ul> <li>Use GitHub Issues</li> <li>Include: OS, C compiler version, reproduction steps</li> <li>Attach minimal test case if possible</li> </ul>"},{"location":"development/testing/","title":"Testing","text":""},{"location":"development/testing/#test-cases","title":"Test Cases","text":""},{"location":"development/testing/#available-cases","title":"Available Cases","text":"Case Purpose Complexity <code>Tien_River</code> Basic multi-branch Simple <code>Mekong_Delta_Full</code> Full validation Complex <code>SaigonDongNai</code> Tributary handling Medium"},{"location":"development/testing/#running-tests","title":"Running Tests","text":"<pre><code># Run all test cases\n.\\scripts\\build-and-run.ps1 -r Tien_River\n.\\scripts\\build-and-run.ps1 -r Mekong_Delta_Full\n.\\scripts\\build-and-run.ps1 -r SaigonDongNai\n</code></pre>"},{"location":"development/testing/#validation-checks","title":"Validation Checks","text":""},{"location":"development/testing/#1-mass-conservation","title":"1. Mass Conservation","text":"<pre><code># Check mass balance at junctions\ndef check_mass_balance(branches, junction_node):\n    Q_in = sum(b['Q'] for b in branches if b['direction'] == 'in')\n    Q_out = sum(b['Q'] for b in branches if b['direction'] == 'out')\n    assert abs(Q_in - Q_out) &lt; 0.01 * Q_in, \"Mass balance violation\"\n</code></pre>"},{"location":"development/testing/#2-numerical-stability","title":"2. Numerical Stability","text":"<ul> <li>No NaN values in output</li> <li>No negative concentrations</li> <li>Bounded velocities</li> </ul>"},{"location":"development/testing/#3-physical-consistency","title":"3. Physical Consistency","text":"<ul> <li>Salinity between 0-35 PSU</li> <li>O\u2082 positive</li> <li>pH between 6-9</li> </ul>"},{"location":"development/testing/#adding-new-tests","title":"Adding New Tests","text":"<ol> <li>Create case directory under <code>INPUT/Cases/</code></li> <li>Add configuration files</li> <li>Document expected results</li> <li>Add to CI workflow</li> </ol>"},{"location":"getting-started/installation/","title":"Installation","text":""},{"location":"getting-started/installation/#prerequisites","title":"Prerequisites","text":""},{"location":"getting-started/installation/#windows","title":"Windows","text":"<ol> <li> <p>MinGW-w64 compiler (via MSYS2):    <pre><code># Install MSYS2 from https://www.msys2.org/\n# Then in MSYS2 terminal:\npacman -S mingw-w64-x86_64-gcc mingw-w64-x86_64-make\n</code></pre></p> </li> <li> <p>Add to PATH:    <pre><code># Add C:\\msys64\\mingw64\\bin to your system PATH\n</code></pre></p> </li> <li> <p>Python 3.8+ (for output processing):    <pre><code># Install from https://www.python.org/\npip install numpy pandas netCDF4 matplotlib\n</code></pre></p> </li> </ol>"},{"location":"getting-started/installation/#linux-macos","title":"Linux / macOS","text":"<ol> <li> <p>GCC compiler:    <pre><code># Ubuntu/Debian\nsudo apt-get install build-essential\n\n# macOS (Xcode command line tools)\nxcode-select --install\n</code></pre></p> </li> <li> <p>Python 3.8+:    <pre><code>pip install numpy pandas netCDF4 matplotlib\n</code></pre></p> </li> </ol>"},{"location":"getting-started/installation/#download","title":"Download","text":"<p>Clone Repository</p> <pre><code>git clone https://github.com/nguytruonganlab/CGEM_network.git\ncd CGEM_network\n</code></pre>"},{"location":"getting-started/installation/#build","title":"Build","text":"Windows (PowerShell)Linux/macOS <pre><code>cd CGEM_network\n.\\scripts\\build.bat\n</code></pre> <pre><code>cd CGEM_network\nmake\n</code></pre> <p>The executable will be created at:</p> <ul> <li>Windows: <code>bin\\Debug\\CGEM_Network.exe</code></li> <li>Linux/macOS: <code>bin/CGEM_Network</code></li> </ul>"},{"location":"getting-started/installation/#verify-installation","title":"Verify Installation","text":"<p>Run the test case:</p> WindowsLinux/macOS <pre><code>.\\bin\\Debug\\CGEM_Network.exe INPUT/Cases/Tien_River/case_config.txt\n</code></pre> <pre><code>./bin/CGEM_Network INPUT/Cases/Tien_River/case_config.txt\n</code></pre> <p>Expected output: <pre><code>==============================================\n  C-GEM Network Engine\n==============================================\n  Case        : Tien_River\n  Branches    : 5\n  Nodes       : 6\n  Duration    : 30 days\n==============================================\n\nDay    1.0 (  3.3%)          | H=12.50 m, U=0.15 m/s, S=5.2 | 1.2 s elapsed\n...\nSimulation complete: 8640 steps in 45.2 seconds\n</code></pre></p>"},{"location":"getting-started/installation/#optional-nlopt-library-for-calibration","title":"Optional: NLopt Library (for Calibration)","text":"<p>The calibration module requires NLopt for optimization:</p> WindowsLinuxmacOS <p>NLopt is pre-built and included in <code>external/nlopt/build/</code>. The build script automatically links it.</p> <pre><code># Ubuntu/Debian\nsudo apt-get install libnlopt-dev\n\n# Or build from source\ngit clone https://github.com/stevengj/nlopt.git\ncd nlopt\nmkdir build &amp;&amp; cd build\ncmake ..\nmake\nsudo make install\n</code></pre> <pre><code>brew install nlopt\n</code></pre>"},{"location":"getting-started/installation/#directory-structure-after-installation","title":"Directory Structure After Installation","text":"<pre><code>CGEM_network/\n\u251c\u2500\u2500 bin/\n\u2502   \u2514\u2500\u2500 Debug/\n\u2502       \u251c\u2500\u2500 CGEM_Network.exe    # Main executable\n\u2502       \u2514\u2500\u2500 libnlopt.dll        # NLopt library (Windows)\n\u251c\u2500\u2500 INPUT/\n\u2502   \u2514\u2500\u2500 Cases/\n\u2502       \u251c\u2500\u2500 Mekong_Delta_Full/  # Main test case\n\u2502       \u251c\u2500\u2500 Tien_River/         # Simple test case\n\u2502       \u2514\u2500\u2500 ...\n\u251c\u2500\u2500 OUTPUT/\n\u2502   \u2514\u2500\u2500 (simulation outputs)\n\u251c\u2500\u2500 scripts/\n\u2502   \u251c\u2500\u2500 build.bat               # Windows build\n\u2502   \u251c\u2500\u2500 build-and-run.ps1       # Build + run helper\n\u2502   \u2514\u2500\u2500 bin_to_nc.py            # Output conversion\n\u2514\u2500\u2500 src/\n    \u2514\u2500\u2500 (source code)\n</code></pre>"},{"location":"getting-started/installation/#troubleshooting","title":"Troubleshooting","text":""},{"location":"getting-started/installation/#gcc-not-found","title":"\"gcc not found\"","text":"<p>Ensure MinGW bin directory is in PATH: <pre><code>$env:PATH += \";C:\\msys64\\mingw64\\bin\"\n</code></pre></p>"},{"location":"getting-started/installation/#libnloptdll-not-found","title":"\"libnlopt.dll not found\"","text":"<p>Copy the DLL to the bin directory: <pre><code>copy external\\nlopt\\build\\libnlopt.dll bin\\Debug\\\n</code></pre></p>"},{"location":"getting-started/installation/#build-errors-with-math-functions","title":"Build errors with math functions","text":"<p>Ensure <code>-lm</code> is included in the linker flags (check <code>scripts/build.bat</code>).</p>"},{"location":"getting-started/installation/#next-steps","title":"Next Steps","text":""},{"location":"getting-started/installation/#-quick-start-run-your-first-simulation","title":"- Quick Start - Run your first simulation","text":"<ul> <li>Project Structure - Understand the codebase</li> </ul>"},{"location":"getting-started/introduction/","title":"Introduction","text":""},{"location":"getting-started/introduction/#the-challenge-of-delta-biogeochemistry","title":"The Challenge of Delta Biogeochemistry","text":"<p>Tropical deltas like the Mekong, Ganges-Brahmaputra, and Niger face urgent environmental challenges:</p> <ul> <li>Eutrophication from agricultural runoff and urbanization</li> <li>Hypoxia threatening fisheries and aquaculture</li> <li>Greenhouse gas emissions (CO\u2082, CH\u2084, N\u2082O) contributing to climate change</li> <li>Salt intrusion advancing further upstream each dry season</li> <li>Sediment starvation from upstream damming</li> </ul> <p>Understanding these processes requires models that capture both the hydrodynamics of complex tidal networks and the biogeochemical transformations in the water column.</p>"},{"location":"getting-started/introduction/#why-c-gem","title":"Why C-GEM?","text":""},{"location":"getting-started/introduction/#the-problem-with-existing-models","title":"The Problem with Existing Models","text":"Model Strengths Limitations TELEMAC-2D/3D Unstructured grids, morphodynamics Complex setup, expensive computation Delft3D-FLOW/WAQ Comprehensive WQ Steep learning curve, commercial MIKE 11/21 User-friendly GUI Expensive licensing HEC-RAS Free, flood modeling No biogeochemistry"},{"location":"getting-started/introduction/#the-c-gem-solution","title":"The C-GEM Solution","text":"<p>C-GEM Network fills the niche for rapid, process-based biogeochemical modeling:</p> <pre><code>                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                    \u2502         MODEL COMPLEXITY            \u2502\n                    \u2502                                     \u2502\n    Empirical \u25c4\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba  \u2502 Process-Based\n    (LOADEST)       \u2502                                     \u2502 (RIVE)\n                    \u2502              C-GEM \u25cf                \u2502\n                    \u2502                   \\                 \u2502\n                    \u2502   HEC-RAS \u25cf        \\   Delft3D \u25cf   \u2502\n                    \u2502                     \\              \u2502\n                    \u2502         MIKE11 \u25cf     \\  TELEMAC \u25cf \u2502\n                    \u2502                       \u2193            \u2502\n                    \u2502                    COMPUTATIONAL   \u2502\n                    \u2502                       COST         \u2502\n                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>C-GEM combines:</p> <ul> <li>\u2705 Process-based biogeochemistry (C-RIVE)</li> <li>\u2705 Network topology (graph-based)</li> <li>\u2705 Fast computation (1D)</li> <li>\u2705 Open source (ANSI C)</li> </ul>"},{"location":"getting-started/introduction/#target-applications","title":"Target Applications","text":"<p>C-GEM is designed for:</p> <ol> <li>Research questions requiring many model runs</li> <li>Sensitivity analysis</li> <li>Uncertainty quantification</li> <li> <p>Climate scenarios</p> </li> <li> <p>Data-sparse regions</p> </li> <li>Tropical deltas with limited monitoring</li> <li> <p>Developing countries without expensive model licenses</p> </li> <li> <p>Integrated assessment</p> </li> <li>Coupling with land-use models</li> <li>Policy scenario evaluation</li> <li>Rapid screening studies</li> </ol>"},{"location":"getting-started/introduction/#key-capabilities","title":"Key Capabilities","text":""},{"location":"getting-started/introduction/#multi-branch-network-topology","title":"Multi-Branch Network Topology","text":"<p>Unlike 1D models that simulate single channels, C-GEM handles:</p> <pre><code>          Upstream 1                    Upstream 2\n              \u2502                             \u2502\n              \u25bc                             \u25bc\n         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n         \u2502 Tien   \u2502                    \u2502  Hau   \u2502\n         \u2502 Main   \u2502                    \u2502  Main  \u2502\n         \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2518                    \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2518\n              \u2502          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2510          \u2502\n              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524VamNao\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2502\n              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n              \u25bc               \u25bc               \u25bc\n         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n         \u2502Co Chien\u2502      \u2502Ham     \u2502      \u2502 Hau    \u2502\n         \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2518      \u2502Luong   \u2502      \u2502 River  \u2502\n              \u2502          \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2518      \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2518\n              \u25bc               \u25bc               \u25bc\n           Ocean           Ocean           Ocean\n</code></pre>"},{"location":"getting-started/introduction/#complete-biogeochemistry","title":"Complete Biogeochemistry","text":"<p>The C-RIVE module includes:</p> Process Species Reference Primary production PHY1, PHY2, O\u2082, DIC Garnier et al. (1995) Organic matter degradation TOC \u2192 DIC, O\u2082 consumption Billen et al. (1994) Nitrification NH\u2084 \u2192 NO\u2082 \u2192 NO\u2083 Wang et al. (2018) Denitrification NO\u2083 \u2192 N\u2082 Hasanyar et al. (2022) Carbonate chemistry DIC, TA, pH, pCO\u2082 Millero (2007) GHG emissions CO\u2082, CH\u2084, N\u2082O Process-based"},{"location":"getting-started/introduction/#automatic-calibration","title":"Automatic Calibration","text":"<p>Built-in calibration with NLopt optimization:</p> <pre><code># Run 3-stage calibration\n.\\bin\\Debug\\CGEM_Network.exe INPUT/Cases/Mekong_Delta_Full/case_config.txt --calibrate\n\n# Stage 1: Hydrodynamics (tidal range, salinity intrusion)\n# Stage 2: Sediment (SPM, ETM location)\n# Stage 3: Biogeochemistry (O2, nutrients)\n</code></pre>"},{"location":"getting-started/introduction/#getting-started","title":"Getting Started","text":"<p>Ready to dive in? Start with:</p> <ol> <li>Installation Guide - Set up your environment</li> <li>Quick Start - Run your first simulation</li> <li>Project Structure - Understand the codebase</li> </ol>"},{"location":"getting-started/quickstart/","title":"Quick Start","text":"<p>This guide walks you through running your first C-GEM simulation using the Mekong Delta case.</p>"},{"location":"getting-started/quickstart/#1-build-the-model","title":"1. Build the Model","text":"Windows (PowerShell)One-liner <pre><code>cd C:\\path\\to\\CGEM_network\n.\\scripts\\build.bat\n</code></pre> <pre><code>.\\scripts\\build-and-run.ps1 -r Mekong_Delta_Full\n</code></pre>"},{"location":"getting-started/quickstart/#2-run-a-simulation","title":"2. Run a Simulation","text":"<pre><code>.\\bin\\Debug\\CGEM_Network.exe INPUT/Cases/Mekong_Delta_Full/case_config.txt\n</code></pre> <p>You'll see progress output: <pre><code>==============================================\n  C-GEM Network Engine\n==============================================\n  Case        : Mekong_Delta_Full\n  Branches    : 9\n  Nodes       : 10\n  Species     : 30\n  Time step   : 300.0 s\n  Duration    : 30 days\n  Warmup      : 10 days\n==============================================\n\nDay    0.0 (  0.0%) [WARMUP] | H=15.00 m, U=0.100 m/s, S=0.1 | 0.0 s elapsed\nDay    1.0 (  3.3%) [WARMUP] | H=15.40 m, U=0.142 m/s, S=0.1 | 2.4 s elapsed\n...\nDay   30.0 (100.0%)          | H=15.41 m, U=0.154 m/s, S=26.4 | 76.6 s elapsed\n\nSimulation complete: 8640 steps in 76.6 seconds (112.8 steps/s)\nCSV output written to: .\\OUTPUT\\Mekong_Delta_Full/CSV\n</code></pre></p>"},{"location":"getting-started/quickstart/#3-view-results","title":"3. View Results","text":""},{"location":"getting-started/quickstart/#csv-output","title":"CSV Output","text":"<p>Results are written to <code>OUTPUT/Mekong_Delta_Full/CSV/</code>:</p> <pre><code>OUTPUT/Mekong_Delta_Full/CSV/\n\u251c\u2500\u2500 Tien_Main.csv\n\u251c\u2500\u2500 Hau_Main.csv\n\u251c\u2500\u2500 Co_Chien.csv\n\u251c\u2500\u2500 Ham_Luong.csv\n\u251c\u2500\u2500 Hau_River.csv\n\u2514\u2500\u2500 ...\n</code></pre> <p>Each CSV contains: - Time series at hourly intervals - Variables: depth, velocity, salinity, O2, nutrients, etc. - One file per branch</p>"},{"location":"getting-started/quickstart/#quick-plot-python","title":"Quick Plot (Python)","text":"<pre><code>import pandas as pd\nimport matplotlib.pyplot as plt\n\n# Load Ham Luong branch output\ndf = pd.read_csv('OUTPUT/Mekong_Delta_Full/CSV/Ham_Luong.csv')\n\n# Plot salinity at different locations\nfig, ax = plt.subplots(figsize=(10, 6))\nax.plot(df['time_days'], df['salinity_x10'], label='10 km from mouth')\nax.plot(df['time_days'], df['salinity_x30'], label='30 km from mouth')\nax.plot(df['time_days'], df['salinity_x50'], label='50 km from mouth')\nax.set_xlabel('Time (days)')\nax.set_ylabel('Salinity (PSU)')\nax.legend()\nplt.show()\n</code></pre>"},{"location":"getting-started/quickstart/#4-run-calibration","title":"4. Run Calibration","text":"<p>C-GEM includes built-in calibration using NLopt:</p> <pre><code># Run full 3-stage calibration\n.\\bin\\Debug\\CGEM_Network.exe INPUT/Cases/Mekong_Delta_Full/case_config.txt --calibrate\n\n# Run only Stage 1 (hydrodynamics)\n.\\bin\\Debug\\CGEM_Network.exe INPUT/Cases/Mekong_Delta_Full/case_config.txt --calibrate --stage 1\n\n# With options\n.\\bin\\Debug\\CGEM_Network.exe INPUT/Cases/Mekong_Delta_Full/case_config.txt --calibrate --max-iter 50 --verbose 2\n</code></pre> <p>Output: <pre><code>==============================================\n  CALIBRATION MODE\n==============================================\n\nLoaded 30 calibration parameters from calibration_params.csv\nLoaded 32 calibration objectives from calibration_targets.csv\nLoaded 14 seasonal observation groups from seasonal_targets.csv\n\nOptimizing 11 parameters for stage 1 using NLopt\nNLopt algorithm: BOBYQA bound-constrained optimization\n\n...\n\n========== CALIBRATION SUMMARY ==========\n\nOPTIMIZED PARAMETERS:\nName                      Initial    Best       Min        Max\n--------------------------------------------------------------\nChezy_River                  60.0000    58.5234    45.0000    75.0000\nVDB_Estuary                   0.3000     0.4521     0.1000     0.6000\n...\n\nFinal RMSE: 12.4523\nTotal evaluations: 50\n</code></pre></p>"},{"location":"getting-started/quickstart/#5-configure-your-own-case","title":"5. Configure Your Own Case","text":""},{"location":"getting-started/quickstart/#directory-structure","title":"Directory Structure","text":"<p>Create a new case in <code>INPUT/Cases/YourCase/</code>:</p> <pre><code>INPUT/Cases/YourCase/\n\u251c\u2500\u2500 case_config.txt           # Main configuration\n\u251c\u2500\u2500 topology.csv              # Network structure\n\u251c\u2500\u2500 boundary_map.csv          # Boundary conditions\n\u251c\u2500\u2500 biogeo_params.txt         # Biogeochemistry parameters\n\u251c\u2500\u2500 species_river.csv         # Upstream species concentrations\n\u251c\u2500\u2500 species_ocean.csv         # Ocean species concentrations\n\u251c\u2500\u2500 calibration_params.csv    # (optional) Parameters to calibrate\n\u251c\u2500\u2500 calibration_targets.csv   # (optional) Calibration objectives\n\u2514\u2500\u2500 seasonal_targets.csv      # (optional) Seasonal observations\n</code></pre>"},{"location":"getting-started/quickstart/#minimal-case_configtxt","title":"Minimal case_config.txt","text":"<pre><code>CaseName = YourCase\n\n# Files\nTopology = topology.csv\nBoundaryMap = boundary_map.csv\nOutputDir = OUTPUT/YourCase\n\n# Time\nStartDate = 2024-01-01\nDuration = 30\nWarmup = 10\n\n# Numerics\nTimeStep = 300.0\nDELXI = 2000.0\n\n# Output\nWriteCSV = 1\n</code></pre>"},{"location":"getting-started/quickstart/#minimal-topologycsv","title":"Minimal topology.csv","text":"<pre><code>BranchID,BranchName,NodeUp,NodeDown,Length_m,Width_Down_m,Width_Up_m,Depth_m,Chezy\n1,Main_Channel,1,2,50000,500,300,10,55\n</code></pre>"},{"location":"getting-started/quickstart/#minimal-boundary_mapcsv","title":"Minimal boundary_map.csv","text":"<pre><code>NodeID,BoundaryType,ForcingFile\n1,DISCHARGE,upstream_Q.csv\n2,LEVEL,downstream_tide.csv\n</code></pre>"},{"location":"getting-started/quickstart/#common-issues","title":"Common Issues","text":""},{"location":"getting-started/quickstart/#no-output-files","title":"\"No output files\"","text":"<ul> <li>Check <code>WriteCSV = 1</code> in case_config.txt</li> <li>Ensure <code>OutputDir</code> exists or can be created</li> </ul>"},{"location":"getting-started/quickstart/#unstable-simulation","title":"\"Unstable simulation\"","text":"<ul> <li>Reduce time step: <code>TimeStep = 150.0</code></li> <li>Check boundary conditions for sudden jumps</li> <li>Verify geometry (width ratios, depths)</li> </ul>"},{"location":"getting-started/quickstart/#calibration-not-converging","title":"\"Calibration not converging\"","text":"<ul> <li>Increase iterations: <code>--max-iter 100</code></li> <li>Check parameter bounds in calibration_params.csv</li> <li>Verify observation data in calibration_targets.csv</li> </ul>"},{"location":"getting-started/quickstart/#next-steps","title":"Next Steps","text":"<ul> <li>Data Preparation - Prepare input files</li> <li>Calibration Guide - Detailed calibration workflow</li> <li>Mekong Delta Case - Full case study</li> </ul>"},{"location":"getting-started/structure/","title":"Project Structure","text":""},{"location":"getting-started/structure/#overview","title":"Overview","text":"<pre><code>CGEM_network/\n\u251c\u2500\u2500 src/                    # Source code\n\u2502   \u251c\u2500\u2500 *.c, *.h           # Core framework\n\u2502   \u251c\u2500\u2500 physics/           # Hydrodynamics + Transport\n\u2502   \u251c\u2500\u2500 rive/              # C-RIVE Biogeochemistry\n\u2502   \u251c\u2500\u2500 io/                # Input/Output\n\u2502   \u2514\u2500\u2500 optimization/      # Calibration (NLopt)\n\u251c\u2500\u2500 INPUT/                 # Input data\n\u2502   \u2514\u2500\u2500 Cases/             # Case configurations\n\u251c\u2500\u2500 OUTPUT/                # Simulation outputs\n\u251c\u2500\u2500 external/              # External libraries\n\u2502   \u2514\u2500\u2500 nlopt/            # NLopt optimization library\n\u251c\u2500\u2500 scripts/               # Build and utility scripts\n\u251c\u2500\u2500 docs/                  # Documentation (MkDocs)\n\u2514\u2500\u2500 .github/               # GitHub workflows + Copilot instructions\n</code></pre>"},{"location":"getting-started/structure/#source-code-src","title":"Source Code (<code>src/</code>)","text":""},{"location":"getting-started/structure/#core-framework","title":"Core Framework","text":"File Purpose <code>define.h</code> Constants, species/reaction enums, macros <code>network.h</code> Core data structures: Branch, Node, Network, CaseConfig <code>main.c</code> Entry point, argument parsing <code>init.c</code> Network initialization orchestration <code>network_data.c</code> Memory allocation (<code>allocate_branch()</code>, <code>free_branch()</code>) <code>network_simulation.c</code> Main time-stepping loop <code>utilities.c</code> Helper functions"},{"location":"getting-started/structure/#physics-module-srcphysics","title":"Physics Module (<code>src/physics/</code>)","text":"File Purpose <code>hydrodynamics.c</code> Saint-Venant solver, geometry, friction <code>solver_hydro.c</code> Network-level stepping, junction iteration <code>transport.c</code> Advection-dispersion, TVD schemes, Van den Burgh"},{"location":"getting-started/structure/#c-rive-biogeochemistry-srcrive","title":"C-RIVE Biogeochemistry (<code>src/rive/</code>)","text":"File Purpose <code>rive.h</code> Master include header <code>rive_common.h</code> Shared constants, temperature functions <code>rive_params.h/.c</code> Parameter loading from <code>biogeo_params.txt</code> <code>biogeo.c</code> Main biogeochemistry driver <code>phytoplankton.h/.c</code> PHY1 (diatoms), PHY2 (greens) <code>nutrients.h/.c</code> N/P/Si cycling <code>oxygen.h/.c</code> O\u2082 dynamics, reaeration <code>carbonate_chem.h/.c</code> DIC, TA, pH, pCO\u2082 <code>ghg_module.h/.c</code> N\u2082O, CH\u2084 emissions <code>rk4_solver.h/.c</code> Runge-Kutta 4 integrator <code>sediment.c</code> SPM erosion/deposition"},{"location":"getting-started/structure/#inputoutput-srcio","title":"Input/Output (<code>src/io/</code>)","text":"File Purpose <code>config_parser.c</code> Parse <code>case_config.txt</code> <code>io_network.c</code> Load topology.csv, boundary_map.csv <code>io_manager.c</code> Output coordination <code>file.c</code> Binary and CSV writers <code>network_loader.c</code> Loading utilities"},{"location":"getting-started/structure/#calibration-srcoptimization","title":"Calibration (<code>src/optimization/</code>)","text":"File Purpose <code>calibration.h</code> Calibration structures and API <code>calibration.c</code> NLopt integration, objective functions, seasonal RMSE"},{"location":"getting-started/structure/#data-structures","title":"Data Structures","text":""},{"location":"getting-started/structure/#network","title":"Network","text":"<pre><code>typedef struct {\n    Branch **branches;          // Array of branch pointers\n    Node *nodes;                // Array of nodes\n    size_t num_branches;\n    size_t num_nodes;\n    int num_species;\n\n    // Simulation parameters\n    double dt;                  // Time step [s]\n    double dx_target;           // Target grid spacing [m]\n    double total_time;          // Total simulation time [s]\n    double warmup_time;         // Warmup period [s]\n\n    // Forcing\n    double tidal_amplitude;\n    double Q_river;\n} Network;\n</code></pre>"},{"location":"getting-started/structure/#branch","title":"Branch","text":"<pre><code>typedef struct {\n    // Identity\n    int id;\n    char name[64];\n    int node_up, node_down;\n\n    // Geometry\n    double length_m;\n    double width_down_m, width_up_m;\n    double depth_m;\n    double chezy;\n    double lc_convergence;      // Exponential convergence length [m]\n\n    // Grid\n    int M;                      // Number of cells\n    double dx;                  // Cell size [m]\n\n    // State arrays [0..M+1] (includes ghost cells)\n    double *depth;\n    double *velocity;\n    double *waterLevel;\n    double *totalArea;\n    double *width;\n    double *dispersion;\n\n    // Species [num_species][0..M+1]\n    double **conc;\n\n    // Reactions [num_reactions][0..M+1]\n    double **reaction_rates;\n\n    // Biogeochemistry parameters\n    BiogeoParams *biogeo;\n} Branch;\n</code></pre>"},{"location":"getting-started/structure/#node","title":"Node","text":"<pre><code>typedef struct {\n    int id;\n    NodeType type;              // JUNCTION, DISCHARGE_BC, LEVEL_BC\n\n    // State\n    double H, H_new;            // Water level [m]\n    double Q_net;               // Net discharge [m\u00b3/s]\n\n    // Connectivity\n    int *connected_branches;\n    int *connection_dir;        // +1 = outflow, -1 = inflow\n    int num_connections;\n\n    // Forcing\n    double *forcing_time;\n    double *forcing_value;\n    int forcing_len;\n\n    // Species mixing\n    double *mixed_conc;\n} Node;\n</code></pre>"},{"location":"getting-started/structure/#grid-convention","title":"Grid Convention","text":"<p>C-GEM uses a staggered grid following Preissmann:</p> <pre><code>Index:    0     1     2     3     4     5    ...    M    M+1\n        ghost                                      last  ghost\n          \u2502     \u2502     \u2502     \u2502     \u2502     \u2502           \u2502     \u2502\n          \u25bc     \u25bc     \u25bc     \u25bc     \u25bc     \u25bc           \u25bc     \u25bc\nGrid:   \u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500 ... \u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\n          \u2502     \u2502     \u2502     \u2502     \u2502     \u2502           \u2502     \u2502\n          U     H     U     H     U     H           H     U\n         vel  scal   vel  scal   vel  scal        scal   vel\n</code></pre> <ul> <li>Even indices (0, 2, 4...): Velocity points</li> <li>Odd indices (1, 3, 5...): Scalar points (depth, concentration)</li> <li>Index 1: Downstream boundary (ocean)</li> <li>Index M: Upstream boundary (river)</li> <li>Indices 0, M+1: Ghost cells for boundary conditions</li> </ul>"},{"location":"getting-started/structure/#build-system","title":"Build System","text":""},{"location":"getting-started/structure/#windows-scriptsbuildbat","title":"Windows (<code>scripts/build.bat</code>)","text":"<pre><code>@echo off\nset CC=C:\\msys64\\mingw64\\bin\\gcc.exe\nset CFLAGS=-std=c11 -O2 -Wall -Wextra\nset INCLUDES=-Isrc -Isrc/rive -Isrc/physics -Isrc/io -Iexternal/nlopt/src/api\nset LDFLAGS=-Lexternal/nlopt/build -lnlopt -lm\n\n# Compile all modules\ngcc %CFLAGS% %INCLUDES% -c src/*.c src/physics/*.c src/rive/*.c src/io/*.c src/optimization/*.c\n\n# Link\ngcc -o bin/Debug/CGEM_Network.exe *.o %LDFLAGS%\n</code></pre>"},{"location":"getting-started/structure/#scripts","title":"Scripts","text":"Script Purpose <code>build.bat</code> Windows build script <code>build-and-run.ps1</code> Build + run helper <code>bin_to_nc.py</code> Convert binary output to NetCDF <code>plot_netcdf.py</code> Quick visualization <code>generate_mekong_inputs.py</code> Generate Mekong case inputs"},{"location":"getting-started/structure/#inputoutput-flow","title":"Input/Output Flow","text":"<pre><code>                            INPUT\n                              \u2502\n        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n        \u25bc                     \u25bc                     \u25bc\n   case_config.txt      topology.csv        boundary_map.csv\n        \u2502                     \u2502                     \u2502\n        \u25bc                     \u25bc                     \u25bc\n  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n  \u2502 CaseConfig  \u2502      \u2502  Network    \u2502      \u2502   Nodes     \u2502\n  \u2502             \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2502  Branches   \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2502   Forcing   \u2502\n  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2502\n                              \u25bc\n                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                    \u2502    SIMULATION       \u2502\n                    \u2502   network_run_      \u2502\n                    \u2502   simulation()      \u2502\n                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2502\n        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n        \u25bc                     \u25bc                     \u25bc\n   Binary (.bin)         CSV files            NetCDF (.nc)\n   (raw output)      (per-branch)          (consolidated)\n                            OUTPUT\n</code></pre>"},{"location":"physics/biogeochemistry/","title":"Biogeochemistry Module","text":""},{"location":"physics/biogeochemistry/#overview","title":"Overview","text":"<p>The C-GEM biogeochemistry module implements C-RIVE (Unified RIVE v1.0), a comprehensive process-based model for carbon, nutrient, and oxygen cycling in aquatic systems. Key features include:</p> <ul> <li>Complete carbonate chemistry (DIC, TA, pH, pCO2, CO2 flux)</li> <li>Greenhouse gas dynamics (CO2, CH4, N2O)</li> <li>Multi-pool organic matter (6 pools with different reactivity)</li> <li>Explicit microbial communities (heterotrophic bacteria, nitrifiers)</li> <li>2-step nitrification (NH4 \u2192 NO2 \u2192 NO3)</li> <li>RK4 adaptive solver for numerical stability</li> </ul>"},{"location":"physics/biogeochemistry/#species-and-state-variables","title":"Species and State Variables","text":""},{"location":"physics/biogeochemistry/#core-biogeochemical-species","title":"Core Biogeochemical Species","text":"Index Symbol Name Unit Description 0 SAL Salinity PSU Conservative tracer 1 PHY1 Diatoms \u00b5g C/L Siliceous phytoplankton 2 PHY2 Green algae \u00b5g C/L Non-siliceous phytoplankton 3 DSi Dissolved silica \u00b5mol/L Nutrient for diatoms 4 NO3 Nitrate \u00b5mol N/L Oxidized nitrogen 5 NH4 Ammonium \u00b5mol N/L Reduced nitrogen 6 PO4 Phosphate \u00b5mol P/L Dissolved reactive P 7 O2 Dissolved oxygen \u00b5mol/L ~312 \u00b5mol/L at saturation 9 SPM Suspended matter mg/L Affects light, adsorption"},{"location":"physics/biogeochemistry/#carbonate-system","title":"Carbonate System","text":"Index Symbol Name Unit Description 10 DIC Dissolved inorganic C \u00b5mol/L CO2 + HCO3\u207b + CO3\u00b2\u207b 11 TA Total alkalinity \u00b5eq/L Acid-neutralizing capacity 12 pCO2 CO2 partial pressure \u00b5atm Diagnostic 13 CO2 Dissolved CO2 \u00b5mol/L Diagnostic 14 pH Acidity - Diagnostic"},{"location":"physics/biogeochemistry/#rive-organic-matter-pools","title":"RIVE Organic Matter Pools","text":"Index Symbol Name Reactivity 17 HD1 Labile dissolved OC Fast (k = 0.5-1.0 /day) 18 HD2 Semi-labile dissolved OC Medium (k = 0.1-0.3 /day) 19 HD3 Refractory dissolved OC Slow (k = 0.01-0.05 /day) 20 HP1 Labile particulate OC Fast 21 HP2 Semi-labile particulate OC Medium 22 HP3 Refractory particulate OC Slow"},{"location":"physics/biogeochemistry/#rive-microbial-pools","title":"RIVE Microbial Pools","text":"Index Symbol Name Description 23 BAG Attached bacteria Large, particle-associated 24 BAP Free bacteria Small, planktonic 25 PIP Particulate inorganic P Adsorbed on SPM 26 DSS Dissolved simple substrates Bacterial food source"},{"location":"physics/biogeochemistry/#greenhouse-gas-species","title":"Greenhouse Gas Species","text":"Index Symbol Name Unit Source 27 NO2 Nitrite \u00b5mol N/L Nitrification intermediate 28 N2O Nitrous oxide nmol N/L GHG from nitrif/denit 29 CH4 Methane \u00b5mol C/L GHG from methanogenesis"},{"location":"physics/biogeochemistry/#phytoplankton-module","title":"Phytoplankton Module","text":""},{"location":"physics/biogeochemistry/#growth-model","title":"Growth Model","text":"<p>Phytoplankton growth follows the Eilers-Peeters photosynthesis model:</p> \\[\\mu = \\mu_{max} \\cdot f_T \\cdot f_L \\cdot f_N\\] <p>Where: - \\(\\mu_{max}\\) = Maximum growth rate [/day] - \\(f_T\\) = Temperature function - \\(f_L\\) = Light limitation - \\(f_N\\) = Nutrient limitation</p>"},{"location":"physics/biogeochemistry/#light-limitation","title":"Light Limitation","text":"<p>Depth-integrated photosynthesis:</p> \\[f_L = \\frac{1}{k_d H} \\left[e^{-k_d H \\cdot e^{-I_0/I_k}} - e^{-I_0/I_k}\\right]\\] <p>Where: - \\(k_d\\) = Light extinction [/m] - \\(H\\) = Water depth [m] - \\(I_0\\) = Surface irradiance [W/m\u00b2] - \\(I_k\\) = Light saturation parameter [W/m\u00b2]</p>"},{"location":"physics/biogeochemistry/#light-extinction","title":"Light Extinction","text":"\\[k_d = k_{d,water} + k_{d,SPM} \\cdot SPM + k_{d,PHY} \\cdot (PHY1 + PHY2)\\] <p>Typical values: - \\(k_{d,water}\\) = 0.1 /m (clear water) - \\(k_{d,SPM}\\) = 0.01 /m per mg/L - \\(k_{d,PHY}\\) = 0.005 /m per \u00b5g C/L</p>"},{"location":"physics/biogeochemistry/#nutrient-limitation","title":"Nutrient Limitation","text":"<p>Diatoms (PHY1) - Liebig's law:</p> \\[f_N = \\min\\left(\\frac{DSi}{DSi + K_{Si}}, \\frac{DIN}{DIN + K_N}, \\frac{PO4}{PO4 + K_P}\\right)\\] <p>Non-siliceous (PHY2):</p> \\[f_N = \\min\\left(\\frac{DIN}{DIN + K_N}, \\frac{PO4}{PO4 + K_P}\\right)\\] <p>Where \\(DIN = NO3 + NH4\\).</p>"},{"location":"physics/biogeochemistry/#nh4no3-preference","title":"NH4/NO3 Preference","text":"<p>Phytoplankton preferentially uptake NH4 (energetically cheaper):</p> \\[f_{NH4} = \\frac{NH4}{K_{NH4,pref} + NH4}\\] <p>NH4 uptake fraction: \\(f_{NH4}\\) NO3 uptake fraction: \\((1 - f_{NH4})\\)</p>"},{"location":"physics/biogeochemistry/#loss-processes","title":"Loss Processes","text":"<ul> <li>Respiration: \\(R = k_R \\cdot f_T \\cdot PHY\\)</li> <li>Mortality: \\(M = k_M \\cdot PHY\\) (feeds detritus)</li> <li>Settling: \\(S = w_s / H \\cdot PHY\\)</li> </ul>"},{"location":"physics/biogeochemistry/#organic-matter-dynamics-rive","title":"Organic Matter Dynamics (RIVE)","text":""},{"location":"physics/biogeochemistry/#multi-pool-conceptual-model","title":"Multi-Pool Conceptual Model","text":"<pre><code>flowchart TD\n          river[\"River Input\"] --&gt; phy[\"Phytoplankton Mortality\"]\n          phy --&gt; particulate[\"Particulate OC&lt;br/&gt;HP1 \u2192 HP2 \u2192 HP3\"]\n          particulate --&gt; hydrolysis[\"Hydrolysis\"]\n          hydrolysis --&gt; dissolved[\"Dissolved OC&lt;br/&gt;HD1 \u2192 HD2 \u2192 HD3\"]\n          dissolved --&gt; bacteria[\"Bacteria&lt;br/&gt;BAG + BAP\"]\n          bacteria --&gt; respiration[\"Respiration&lt;br/&gt;CO\u2082 + NH\u2084 + PO\u2084\"]\n          particulate --&gt; dissolved</code></pre>"},{"location":"physics/biogeochemistry/#hydrolysis-rates","title":"Hydrolysis Rates","text":"\\[\\frac{dHD1}{dt} = k_{hydr,1} \\cdot HD1 + k_{hydr,P1} \\cdot HP1\\] <p>Where hydrolysis converts: - HP (particulate) \u2192 HD (dissolved) - HD (high reactivity) \u2192 DSS (simple substrates)</p>"},{"location":"physics/biogeochemistry/#temperature-dependence","title":"Temperature Dependence","text":"<p>All rates follow Arrhenius:</p> \\[k(T) = k_{20} \\cdot \\theta^{(T-20)}\\] <p>Where: - \\(k_{20}\\) = Rate at 20\u00b0C - \\(\\theta\\) = Temperature coefficient (1.04-1.08)</p>"},{"location":"physics/biogeochemistry/#bacterial-dynamics-rive","title":"Bacterial Dynamics (RIVE)","text":""},{"location":"physics/biogeochemistry/#two-pool-bacteria-model","title":"Two-Pool Bacteria Model","text":"<p>RIVE distinguishes: - BAG: Large (gros), attached, slower growth, higher yield - BAP: Small (petit), free, faster growth, lower yield</p>"},{"location":"physics/biogeochemistry/#growth-on-substrates","title":"Growth on Substrates","text":"\\[\\mu_B = \\mu_{max,B} \\cdot f_T \\cdot \\frac{DSS}{DSS + K_S} \\cdot \\frac{O2}{O2 + K_{O2}}\\] <p>Where DSS = dissolved simple substrates (from hydrolysis).</p>"},{"location":"physics/biogeochemistry/#bacterial-respiration","title":"Bacterial Respiration","text":"\\[R_B = (1 - Y) \\cdot \\mu_B \\cdot B + k_{maint} \\cdot B\\] <p>Where: - \\(Y\\) = Growth yield (0.2-0.4) - \\(k_{maint}\\) = Maintenance respiration [/day]</p>"},{"location":"physics/biogeochemistry/#mortality-and-recycling","title":"Mortality and Recycling","text":"<p>Dead bacteria become particulate OC: \\(\\(\\text{BAG mortality} \u2192 HP1\\)\\) \\(\\(\\text{BAP mortality} \u2192 HD1\\)\\)</p>"},{"location":"physics/biogeochemistry/#nitrogen-cycle","title":"Nitrogen Cycle","text":""},{"location":"physics/biogeochemistry/#2-step-nitrification-from-c-rive","title":"2-Step Nitrification (from C-RIVE)","text":"<p>Step 1 - Nitrosation (NH4 \u2192 NO2):</p> \\[R_{nit1} = k_{nit1} \\cdot f_T \\cdot \\frac{NH4}{NH4 + K_{NH4}} \\cdot \\frac{O2}{O2 + K_{O2,nit}}\\] <p>Step 2 - Nitratation (NO2 \u2192 NO3):</p> \\[R_{nit2} = k_{nit2} \\cdot f_T \\cdot \\frac{NO2}{NO2 + K_{NO2}} \\cdot \\frac{O2}{O2 + K_{O2,nit}}\\] <p>Typical rates at 20\u00b0C: - \\(k_{nit1}\\) = 0.3 /day - \\(k_{nit2}\\) = 0.6 /day (faster, prevents NO2 accumulation)</p>"},{"location":"physics/biogeochemistry/#denitrification","title":"Denitrification","text":"<p>Under low O2 conditions:</p> \\[R_{denit} = k_{denit} \\cdot f_T \\cdot \\frac{OC}{OC + K_{OC}} \\cdot \\frac{NO3}{NO3 + K_{NO3}} \\cdot \\frac{K_{O2,inhib}}{O2 + K_{O2,inhib}}\\] <p>Product: N2 (to atmosphere) + some N2O (GHG)</p>"},{"location":"physics/biogeochemistry/#n2o-production","title":"N2O Production","text":"<p>From C-RIVE:</p> \\[R_{N2O,nit} = \\epsilon_{nit} \\cdot R_{nit1}$$ $$R_{N2O,denit} = \\epsilon_{denit} \\cdot R_{denit}\\] <p>Where: - \\(\\epsilon_{nit}\\) \u2248 0.004 (0.4% of NH4 oxidized) - \\(\\epsilon_{denit}\\) \u2248 0.01 (1% of NO3 reduced)</p>"},{"location":"physics/biogeochemistry/#carbonate-chemistry-c-rive","title":"Carbonate Chemistry (C-RIVE)","text":""},{"location":"physics/biogeochemistry/#dic-ta-ph-system","title":"DIC-TA-pH System","text":"<p>DIC (Dissolved Inorganic Carbon): \\(\\(DIC = [CO2] + [HCO3^-] + [CO3^{2-}]\\)\\)</p> <p>Total Alkalinity: \\(\\(TA = [HCO3^-] + 2[CO3^{2-}] + [OH^-] - [H^+] + ...\\)\\)</p>"},{"location":"physics/biogeochemistry/#ph-calculation","title":"pH Calculation","text":"<p>The Cardano-Vieta analytical solution for [H\u207a]:</p> \\[[H^+]^3 + X[H^+]^2 + Y[H^+] + Z = 0\\] <p>Where X, Y, Z depend on DIC, TA, K1, K2.</p>"},{"location":"physics/biogeochemistry/#co2-speciation","title":"CO2 Speciation","text":"\\[[CO2] = DIC \\cdot \\frac{[H^+]^2}{[H^+]^2 + K_1[H^+] + K_1 K_2}\\] \\[[HCO3^-] = DIC \\cdot \\frac{K_1[H^+]}{[H^+]^2 + K_1[H^+] + K_1 K_2}\\]"},{"location":"physics/biogeochemistry/#dissociation-constants","title":"Dissociation Constants","text":"<p>Temperature-dependent (Harned &amp; Davis):</p> \\[pK_1 = -126.34 + \\frac{6320.8}{T} + 19.57 \\ln(T)\\]"},{"location":"physics/biogeochemistry/#co2-air-water-exchange","title":"CO2 Air-Water Exchange","text":"\\[F_{CO2} = k_{CO2} \\cdot (C_{sat} - [CO2])\\] <p>Where: - \\(k_{CO2}\\) = Gas transfer velocity [m/s] - \\(C_{sat}\\) = Saturation concentration [\u00b5mol/L]</p>"},{"location":"physics/biogeochemistry/#k600-parameterization","title":"k600 Parameterization","text":"<p>For tidal estuaries, C-GEM uses the Abril et al. (2009) formulation, which is specifically developed for macrotidal estuaries like the Scheldt, Gironde, Mekong, and Saigon rivers:</p> <p>\\(\\(k_{600} = 1.0 + 1.719 \\sqrt{v}\\)\\) [cm/h]</p> <p>Where \\(v\\) is the current velocity [m/s].</p> <p>This formulation accounts for: - Tidal currents generating turbulence at the water surface - Typical estuarine mixing conditions - Valid for large tidal estuaries (width &gt; 100 m, tidal range &gt; 1 m)</p> <p>Alternative methods available:</p> Method Formula Application Abril et al. (2009) \\(k_{600} = 1.0 + 1.719\\sqrt{v}\\) Tidal estuaries (default) Borges et al. (2004) \\(k_{600} = 1.0 + U_{10} + 0.25 U_{10}^2\\) Wind-driven, open estuaries Raymond et al. (2012) Strahler-dependent Rivers and streams <p>Note: The Raymond et al. (2012) Strahler-based formulation is designed for rivers, not estuaries. For large tidal systems like the Mekong Delta or Saigon River, the Abril et al. (2009) method is more appropriate as it was calibrated using measurements in similar environments.</p>"},{"location":"physics/biogeochemistry/#schmidt-number-correction","title":"Schmidt Number Correction","text":"\\[k_{CO2} = k_{600} \\cdot \\sqrt{\\frac{600}{Sc}}\\] <p>Where Sc is the Schmidt number: \\(\\(Sc = 1911 - 118T + 3.45T^2 - 0.041T^3\\)\\)</p>"},{"location":"physics/biogeochemistry/#methane-ch4-module","title":"Methane (CH4) Module","text":""},{"location":"physics/biogeochemistry/#sources","title":"Sources","text":"<p>Methanogenesis (anoxic sediments): \\(\\(R_{CH4,prod} = k_{CH4,prod} \\cdot f_T \\cdot OC_{sed} \\cdot f_{anoxic}\\)\\)</p> <p>Benthic flux: \\(\\(F_{CH4,sed} = F_{CH4,0} \\cdot f_T / H\\)\\)</p>"},{"location":"physics/biogeochemistry/#sinks","title":"Sinks","text":"<p>Aerobic oxidation: \\(\\(R_{CH4,ox} = k_{CH4,ox} \\cdot f_T \\cdot \\frac{CH4}{CH4 + K_{CH4}} \\cdot \\frac{O2}{O2 + K_{O2,CH4}}\\)\\)</p> <p>Air-water evasion: \\(\\(F_{CH4,air} = k_{CH4} \\cdot (CH4 - CH4_{sat})\\)\\)</p> <p>Ebullition (bubble release): \\(\\(R_{CH4,ebul} = k_{ebul} \\cdot \\max(0, CH4 - CH4_{thresh})\\)\\)</p> <p>Typical threshold: 50 \u00b5mol/L in shallow water.</p>"},{"location":"physics/biogeochemistry/#oxygen-dynamics","title":"Oxygen Dynamics","text":""},{"location":"physics/biogeochemistry/#sources_1","title":"Sources","text":"\\[\\frac{dO2}{dt}_{sources} = R_{NPP} + F_{O2,air}\\] <p>Where NPP includes photoautotrophic oxygen production.</p>"},{"location":"physics/biogeochemistry/#sinks_1","title":"Sinks","text":"\\[\\frac{dO2}{dt}_{sinks} = -R_{OC,ox} - 1.5 R_{nit1} - 0.5 R_{nit2} - R_{CH4,ox}\\] <p>Stoichiometry: - OC oxidation: 1 mol O2 per mol C - Nitrosation: 1.5 mol O2 per mol NH4 - Nitratation: 0.5 mol O2 per mol NO2 - CH4 oxidation: 2 mol O2 per mol CH4</p>"},{"location":"physics/biogeochemistry/#oxygen-saturation","title":"Oxygen Saturation","text":"<p>Weiss (1970): \\(\\(\\ln(O2_{sat}) = A_1 + \\frac{A_2}{T} + A_3 \\ln(T) + A_4 T + S[B_1 + B_2 T + B_3 T^2]\\)\\)</p> <p>At 25\u00b0C, freshwater: O2_{sat} \u2248 258 \u00b5mol/L (8.3 mg/L)</p>"},{"location":"physics/biogeochemistry/#reaction-network-summary","title":"Reaction Network Summary","text":"<pre><code>flowchart TB\n    atmosphere[\"Atmosphere&lt;br/&gt;CO\u2082 \u00b7 CH\u2084 \u00b7 N\u2082O \u00b7 O\u2082\"] --&gt; water[\"Water Column\"]\n    water --&gt; sediment[\"Sediment&lt;br/&gt;Settling + diffusion\"]\n    subgraph waterMoves [Water Column Processes]\n        phy[\"Phytoplankton\"]\n        oc[\"Organic Carbon (OC)\"]\n        bacteria[\"Bacteria\"]\n        co2[\"CO\u2082\"]\n        nh4[\"NH\u2084\"]\n        po4[\"PO\u2084\"]\n        no2[\"NO\u2082\"]\n        no3[\"NO\u2083\"]\n        n2o[\"N\u2082O\"]\n        n2[\"N\u2082\"]\n        ch4[\"CH\u2084\"]\n        dic[\"DIC \u2194 CO\u2082 \u2194 HCO\u2083\u207b \u2194 CO\u2083\u00b2\u207b\"]\n    end\n    phy --&gt; oc\n    oc --&gt; co2\n    oc --&gt; nh4\n    oc --&gt; po4\n    oc --&gt; ch4\n    oc --&gt; bacteria\n    bacteria --&gt; n2o\n    nh4 --&gt; no2 --&gt; no3 --&gt; n2\n    no3 --&gt; n2o\n    dic --&gt; co2\n    sediment --&gt; co2\n    sediment --&gt; ch4\n    water --&gt; dic</code></pre>"},{"location":"physics/biogeochemistry/#numerical-solver","title":"Numerical Solver","text":""},{"location":"physics/biogeochemistry/#rk4-adaptive-scheme","title":"RK4 Adaptive Scheme","text":"<p>C-GEM uses a 4<sup>th</sup>-order Runge-Kutta solver from C-RIVE:</p> \\[k_1 = f(t, y)$$ $$k_2 = f(t + \\frac{\\Delta t}{2}, y + \\frac{\\Delta t}{2} k_1)$$ $$k_3 = f(t + \\frac{\\Delta t}{2}, y + \\frac{\\Delta t}{2} k_2)$$ $$k_4 = f(t + \\Delta t, y + \\Delta t \\cdot k_3)$$ $$y_{n+1} = y_n + \\frac{\\Delta t}{6}(k_1 + 2k_2 + 2k_3 + k_4)\\]"},{"location":"physics/biogeochemistry/#adaptive-time-stepping","title":"Adaptive Time-Stepping","text":"<p>For stiff reactions, internal subdivision: \\(\\(\\Delta t_{bio} = \\min\\left(\\Delta t, \\frac{C}{|dC/dt|} \\cdot \\alpha\\right)\\)\\)</p> <p>Where \\(\\alpha\\) \u2248 0.5 is a safety factor.</p>"},{"location":"physics/biogeochemistry/#mass-balance-checking","title":"Mass Balance Checking","text":"<p>Each species tracks: - Production from each reaction - Consumption by each reaction - Net change per timestep</p>"},{"location":"physics/biogeochemistry/#parameters","title":"Parameters","text":""},{"location":"physics/biogeochemistry/#phytoplankton","title":"Phytoplankton","text":"Parameter Symbol PHY1 PHY2 Unit Max growth \u00b5max 2.0 1.5 /day Light slope \u03b1 0.02 0.015 m\u00b2/W Half-sat Si KSi 5 - \u00b5M Half-sat N KN 2 3 \u00b5M Half-sat P KP 0.5 0.7 \u00b5M Mortality kM 0.05 0.04 /day Settling ws 0.5 0.3 m/day"},{"location":"physics/biogeochemistry/#organic-matter-rive","title":"Organic Matter (RIVE)","text":"Pool k_hydr [/day] Fraction HD1 0.75 0.15 HD2 0.25 0.35 HD3 0.01 0.50 HP1 0.50 0.10 HP2 0.20 0.30 HP3 0.01 0.60"},{"location":"physics/biogeochemistry/#ghg-parameters","title":"GHG Parameters","text":"Parameter Value Unit Reference N2O yield (nit) 0.004 mol/mol C\u00e9bron 2005 N2O yield (denit) 0.01 mol/mol Garnier 2007 CH4 prod rate 0.01 /day Borges 2011 CH4 ox rate 0.5 /day Borges 2011 CH4 ebul thresh 50 \u00b5mol/L DelSontro 2018"},{"location":"physics/biogeochemistry/#references","title":"References","text":"<ol> <li>Billen, G. et al. (1994). A biogeochemical model of the Scheldt estuary.</li> <li>Garnier, J. et al. (2002). Modelling the nitrogen cycle in the Seine River.</li> <li>Wang, S. et al. (2018). C-RIVE sensitivity analysis. Water Research 144, 341-355.</li> <li>Hasanyar, M. et al. (2022). Unified RIVE v1.0. Biogeosciences.</li> <li>Weiss, R.F. (1974). CO2 in seawater. Marine Chemistry 2, 203-215.</li> <li>Abril, G. et al. (2009). Turbidity limits gas exchange in a large macrotidal estuary. Estuarine, Coastal and Shelf Science 83, 342-348. (k600 for tidal estuaries)</li> <li>Borges, A.V. et al. (2004). Variability of the gas transfer velocity of CO2 in a macrotidal estuary. Estuaries 27, 593-603.</li> <li>Raymond, P.A. et al. (2012). Scaling gas exchange. Limnol. Oceanogr. Fluids Environ. 2, 1-14. (for rivers only)</li> <li>Borges, A.V. &amp; Abril, G. (2011). Carbon dioxide and methane dynamics in estuaries.</li> </ol>"},{"location":"physics/hydrodynamics/","title":"Hydrodynamics Module","text":""},{"location":"physics/hydrodynamics/#overview","title":"Overview","text":"<p>The C-GEM hydrodynamics module solves the 1D Saint-Venant equations on a staggered grid, capturing tidal propagation, river discharge, and water level variations in multi-branch estuarine networks.</p>"},{"location":"physics/hydrodynamics/#governing-equations","title":"Governing Equations","text":""},{"location":"physics/hydrodynamics/#saint-venant-system","title":"Saint-Venant System","text":"<p>The shallow water equations in 1D, assuming hydrostatic pressure and well-mixed cross-sections:</p> <p>Continuity (Mass Conservation):</p> \\[\\frac{\\partial A}{\\partial t} + \\frac{\\partial Q}{\\partial x} = 0\\] <p>Momentum:</p> \\[\\frac{\\partial Q}{\\partial t} + \\frac{\\partial}{\\partial x}\\left(\\frac{Q^2}{A}\\right) + gA\\frac{\\partial H}{\\partial x} + gA S_f = 0\\] <p>Where: - \\(A\\) = Cross-sectional area [m\u00b2] - \\(Q\\) = Discharge [m\u00b3/s] - \\(H\\) = Water surface elevation [m] - \\(g\\) = Gravitational acceleration (9.81 m/s\u00b2) - \\(S_f\\) = Friction slope [-]</p>"},{"location":"physics/hydrodynamics/#friction-formulation","title":"Friction Formulation","text":"<p>Using the Ch\u00e9zy-Manning approach:</p> \\[S_f = \\frac{|Q|Q}{C^2 A^2 R}\\] <p>Where: - \\(C\\) = Ch\u00e9zy coefficient [m^{\u00bd}/s] - \\(R\\) = Hydraulic radius \u2248 \\(A/B\\) for wide channels [m] - \\(B\\) = Channel width [m]</p> <p>The Ch\u00e9zy coefficient relates to Manning's \\(n\\):</p> \\[C = \\frac{R^{1/6}}{n}\\] <p>Typical values for tropical deltas: - \\(n\\) = 0.02-0.03 for main channels - \\(n\\) = 0.03-0.05 for vegetated areas</p>"},{"location":"physics/hydrodynamics/#numerical-scheme","title":"Numerical Scheme","text":""},{"location":"physics/hydrodynamics/#staggered-grid-preissmann-box","title":"Staggered Grid (Preissmann Box)","text":"<p>C-GEM uses a staggered arrangement following Abbott (1979):</p> <pre><code>     U[0]    H[1]    U[2]    H[3]    U[4]    H[5]\n      |       o       |       o       |       o\n      |       |       |       |       |       |\n    --|-------|-------|-------|-------|-------|--\n   x=0      dx/2     dx     3dx/2    2dx    5dx/2\n\n   Even indices: Velocity (U), Discharge (Q)\n   Odd indices:  Scalars (H, A, B, C)\n</code></pre> <p>Advantages: - Natural treatment of boundary conditions - Stable for subcritical flow - Straightforward extension to networks</p>"},{"location":"physics/hydrodynamics/#grid-indexing-convention","title":"Grid Indexing Convention","text":"Index Variable Type Location 0 Velocity Downstream boundary 1 Scalar First internal point 2 Velocity First internal flux ... ... ... M Scalar Last internal point M+1 Velocity Upstream boundary <p>Direction convention: - Index 1 = downstream (ocean side) - Index M = upstream (river side) - Positive velocity = upstream flow (flood tide)</p>"},{"location":"physics/hydrodynamics/#implicit-time-integration","title":"Implicit Time Integration","text":"<p>The momentum equation is discretized implicitly to allow larger time steps:</p> \\[\\frac{Q^{n+1} - Q^n}{\\Delta t} + \\text{advection} + g A \\frac{\\partial H^{n+1}}{\\partial x} + \\text{friction}^{n+1} = 0\\] <p>This yields a tridiagonal system solved by the Thomas algorithm.</p>"},{"location":"physics/hydrodynamics/#cfl-condition","title":"CFL Condition","text":"<p>Stability requires:</p> \\[\\Delta t &lt; \\frac{\\Delta x}{\\sqrt{gH} + |U|}\\] <p>For typical delta parameters (\\(H\\) = 10 m, \\(U\\) = 1 m/s, \\(\\Delta x\\) = 2000 m):</p> \\[\\Delta t &lt; \\frac{2000}{\\sqrt{9.81 \\times 10} + 1} \\approx 180 \\text{ s}\\] <p>The default time step of 300 s is stable for most conditions with implicit friction.</p>"},{"location":"physics/hydrodynamics/#channel-geometry","title":"Channel Geometry","text":""},{"location":"physics/hydrodynamics/#exponentially-varying-width","title":"Exponentially Varying Width","text":"<p>Following Savenije's theory, channel width varies exponentially:</p> \\[B(x) = B_0 \\exp\\left(-\\frac{x}{L_c}\\right)\\] <p>Where: - \\(B_0\\) = Width at mouth [m] - \\(L_c\\) = Convergence length [m] (negative = diverging)</p> <p>This is the characteristic shape of alluvial estuaries formed by tidal-fluvial interaction.</p>"},{"location":"physics/hydrodynamics/#cross-sectional-area","title":"Cross-Sectional Area","text":"<p>For a trapezoidal or approximately rectangular section:</p> \\[A = B \\cdot H\\] <p>The model computes: - <code>totalArea</code>: Total cross-sectional area - <code>freeArea</code>: Area above reference level - <code>refArea</code>: Reference area at datum</p>"},{"location":"physics/hydrodynamics/#storage-width-ratio","title":"Storage Width Ratio","text":"<p>For channels with significant floodplain storage:</p> \\[R_s = \\frac{B_{storage}}{B_{conveyance}}\\] <ul> <li>\\(R_s\\) = 1.0 for prismatic channels</li> <li>\\(R_s\\) = 2-10 for mangrove-fringed channels</li> </ul> <p>This affects tidal damping and phase.</p>"},{"location":"physics/hydrodynamics/#boundary-conditions","title":"Boundary Conditions","text":""},{"location":"physics/hydrodynamics/#downstream-ocean-boundary","title":"Downstream (Ocean) Boundary","text":"<p>Tidal level forcing:</p> \\[H(t) = H_{MSL} + A_0 \\sin\\left(\\frac{2\\pi t}{T}\\right)\\] <p>For realistic multi-constituent tides:</p> \\[H(t) = H_{MSL} + \\sum_i A_i \\cos(\\omega_i t - \\phi_i)\\] <p>Where the dominant constituents in the Mekong are: - M2: \\(T\\) = 12.42 hours, \\(A\\) \u2248 0.8-1.2 m - S2: \\(T\\) = 12.00 hours, \\(A\\) \u2248 0.3-0.5 m - K1: \\(T\\) = 23.93 hours, \\(A\\) \u2248 0.4-0.6 m - O1: \\(T\\) = 25.82 hours, \\(A\\) \u2248 0.3-0.4 m</p>"},{"location":"physics/hydrodynamics/#upstream-river-boundary","title":"Upstream (River) Boundary","text":"<p>Discharge forcing:</p> \\[Q(t) = Q_{river}(t)\\] <p>Seasonal patterns in the Mekong: - Dry season (Jan-May): 2,000-5,000 m\u00b3/s - Wet season (Jul-Oct): 20,000-40,000 m\u00b3/s - Transition (Jun, Nov-Dec): 5,000-15,000 m\u00b3/s</p>"},{"location":"physics/hydrodynamics/#junction-conditions","title":"Junction Conditions","text":"<p>At network junctions, C-GEM enforces:</p> <ol> <li> <p>Mass conservation: \\(\\(\\sum_i Q_i = 0\\)\\)</p> </li> <li> <p>Common water level: \\(\\(H_1 = H_2 = ... = H_n\\)\\)</p> </li> </ol> <p>Where subscripts denote connected branches.</p>"},{"location":"physics/hydrodynamics/#network-topology","title":"Network Topology","text":""},{"location":"physics/hydrodynamics/#branch-structure","title":"Branch Structure","text":"<p>Each branch is defined by:</p> <pre><code>typedef struct {\n    int id;\n    char name[64];\n    int node_up;      // Upstream node ID\n    int node_down;    // Downstream node ID\n    double length_m;  // Channel length [m]\n    double width_up_m, width_down_m;  // Width at ends [m]\n    double depth_m;   // Reference depth [m]\n    double chezy;     // Friction coefficient\n    double lc_convergence;  // Convergence length [m]\n    // ... arrays for H, U, A, B\n} Branch;\n</code></pre>"},{"location":"physics/hydrodynamics/#node-types","title":"Node Types","text":"Type Description Boundary Condition <code>NODE_JUNCTION</code> Internal connection Mass balance, common H <code>NODE_LEVEL_BC</code> Tidal boundary Prescribed H(t) <code>NODE_DISCHARGE_BC</code> River boundary Prescribed Q(t)"},{"location":"physics/hydrodynamics/#example-tien-river-network","title":"Example: Tien River Network","text":"<pre><code>              [2] MyTho \u2190 (ocean)\n             \u2197\n[river] \u2192 [1] Tien_Main \u2192 Junction\n             \u2198\n              [3] HamLuong \u2190 (ocean)\n             \u2198\n              [4] CoChien \u2190 (ocean)\n</code></pre>"},{"location":"physics/hydrodynamics/#tidal-propagation","title":"Tidal Propagation","text":""},{"location":"physics/hydrodynamics/#tidal-amplificationdamping","title":"Tidal Amplification/Damping","text":"<p>In a converging estuary, tidal amplitude can increase upstream due to funnel effect, or decrease due to friction:</p> \\[\\frac{dA}{dx} = A \\left(\\frac{1}{L_c} - \\delta\\right)\\] <p>Where \\(\\delta\\) is the damping coefficient depending on: - Friction (Manning's n) - Geometry (width, depth) - River discharge</p>"},{"location":"physics/hydrodynamics/#phase-lag","title":"Phase Lag","text":"<p>The tidal wave propagates at the celerity:</p> \\[c = \\sqrt{gH}\\] <p>Phase lag between mouth and upstream location:</p> \\[\\Delta\\phi = \\int_0^x \\frac{dx'}{c(x')}\\]"},{"location":"physics/hydrodynamics/#code-implementation","title":"Code Implementation","text":""},{"location":"physics/hydrodynamics/#main-hydrodynamics-function","title":"Main Hydrodynamics Function","text":"<pre><code>int Hyd_Branch(Branch *branch, double H_down, double H_up, double Q_up, double dt);\n</code></pre> <p>Algorithm: 1. Set boundary conditions 2. Compute friction terms (implicit) 3. Build tridiagonal system 4. Solve for H, U at new time 5. Update area, velocity arrays</p>"},{"location":"physics/hydrodynamics/#solver-configuration","title":"Solver Configuration","text":"<pre><code>// In case_config.txt\nTimeStepSeconds = 300   // dt [s]\nDELXI = 2000           // dx [m]\nTidalAmplitude = 1.9   // A0 [m]\nRiverDischarge = 2000  // Q_river [m\u00b3/s]\n</code></pre>"},{"location":"physics/hydrodynamics/#validation","title":"Validation","text":""},{"location":"physics/hydrodynamics/#analytical-solutions","title":"Analytical Solutions","text":"<p>For idealized cases, compare with: - Tidal wave in prismatic channel - Steady flow with friction - Savenije's salt intrusion curves</p>"},{"location":"physics/hydrodynamics/#field-data","title":"Field Data","text":"<p>For the Mekong Delta: - Water level gauges (Can Tho, My Thuan, Tan Chau) - Discharge measurements (MRC stations) - ADCP transects (MRC, SIWRP)</p>"},{"location":"physics/hydrodynamics/#performance-metrics","title":"Performance Metrics","text":"<ul> <li>RMSE of water level &lt; 0.1 m</li> <li>Phase error &lt; 30 minutes</li> <li>Amplitude error &lt; 10%</li> </ul>"},{"location":"physics/hydrodynamics/#references","title":"References","text":"<ol> <li>Abbott, M.B. (1979). Computational Hydraulics. Pitman.</li> <li>Savenije, H.H.G. (2005). Salinity and Tides in Alluvial Estuaries. Elsevier.</li> <li>Cunge, J.A., Holly, F.M., Verwey, A. (1980). Practical Aspects of Computational River Hydraulics. Pitman.</li> <li>Nguyen, A.D. et al. (2008). Water Resources Research. Mekong Delta salt intrusion.</li> </ol>"},{"location":"physics/hydrodynamics/#next-transport-module","title":"Next: Transport Module","text":""},{"location":"physics/introduction/","title":"Introduction: Why C-GEM Network?","text":""},{"location":"physics/introduction/#the-challenge-of-delta-biogeochemistry","title":"The Challenge of Delta Biogeochemistry","text":"<p>The Mekong Delta\u2014like many tropical deltas worldwide\u2014faces urgent environmental challenges:</p> <ul> <li>Eutrophication from agricultural runoff and urbanization</li> <li>Hypoxia threatening fisheries and aquaculture</li> <li>Greenhouse gas emissions (CO2, CH4, N2O) contributing to climate change</li> <li>Acidification affecting shellfish and coral ecosystems</li> <li>Salt intrusion advancing further upstream each dry season</li> </ul> <p>Understanding and predicting these processes requires models that capture both the hydrodynamics of tidal river networks and the biogeochemical transformations occurring in the water column and sediments.</p>"},{"location":"physics/introduction/#existing-models-powerful-but-not-always-appropriate","title":"Existing Models: Powerful but Not Always Appropriate","text":""},{"location":"physics/introduction/#the-2d3d-giants","title":"The 2D/3D Giants","text":"<p>Several world-class hydrodynamic-water quality models exist:</p> Model Strengths Limitations for Delta BGC TELEMAC-2D/3D Unstructured grids, morphodynamics Complex setup, expensive computation, WQ module less developed Delft3D-FLOW/WAQ Comprehensive WQ, sediment Steep learning curve, commercial license for full features MIKE 11/21 User-friendly GUI, well-documented Expensive licensing, proprietary code HEC-RAS Free, widely used for flood modeling Limited biogeochemistry, no carbonate chemistry EFDC EPA-supported, 3D capability Complex calibration, limited GHG modules"},{"location":"physics/introduction/#the-gap","title":"The Gap","text":"<p>These models excel at hydrodynamics and have been successfully applied to the Mekong Delta for: - Flood forecasting - Salt intrusion mapping - Sediment transport - Navigation studies</p> <p>However, for process-based biogeochemical research\u2014especially concerning greenhouse gas emissions and carbon cycling\u2014they often:</p> <ol> <li>Lack specialized modules for estuarine carbonate chemistry</li> <li>Oversimplify organic matter (single-pool vs. multi-pool RIVE)</li> <li>Miss microbial processes (nitrifying bacteria, heterotrophic bacteria dynamics)</li> <li>Don't compute GHG fluxes (N2O from nitrification, CH4 ebullition)</li> <li>Require excessive computation for process studies and sensitivity analysis</li> </ol>"},{"location":"physics/introduction/#why-another-model-the-c-gem-philosophy","title":"Why Another Model? The C-GEM Philosophy","text":""},{"location":"physics/introduction/#1-fit-for-purpose-complexity","title":"1. Fit-for-Purpose Complexity","text":"<p>\"Everything should be made as simple as possible, but not simpler.\" \u2014 Einstein</p> <p>For biogeochemical process studies in tidal rivers, we need: - Enough physics to get the tidal mixing and residence times right - Detailed biogeochemistry to capture microbial transformations - Fast computation to enable sensitivity analysis, calibration, and scenario testing</p> <p>A 1D network model achieves this balance. Cross-sectional averaging is justified when: - Channels are well-mixed vertically (shallow, tidal mixing) - Longitudinal gradients dominate lateral ones - The research focus is biogeochemical, not hydrodynamic</p>"},{"location":"physics/introduction/#2-the-c-rive-advantage","title":"2. The C-RIVE Advantage","text":"<p>C-GEM integrates C-RIVE (Unified RIVE v1.0), the state-of-the-art ANSI C implementation of the RIVE biogeochemical model developed at Mines Paris. RIVE has been refined over 30+ years and includes:</p> Feature RIVE Typical WQ Model Organic matter 6-pool (HD\u00bd/3, HP\u00bd/3) 1-2 pools Bacteria Explicit BAG/BAP dynamics Implicit first-order decay Nitrification 2-step (NH4\u2192NO2\u2192NO3) 1-step N2O production Explicit (nit + denit pathways) Not included CH4 dynamics Production, oxidation, ebullition Rarely included Carbonate chemistry Full DIC-TA-pH-pCO2 system Often simplified Phosphorus Adsorption-desorption equilibrium Fixed partitioning"},{"location":"physics/introduction/#3-research-oriented-design","title":"3. Research-Oriented Design","text":"<p>C-GEM is designed for research questions, not operational forecasting:</p> <ul> <li>Sensitivity analysis: What parameters most affect pCO2 emissions?</li> <li>Process attribution: How much CO2 comes from benthic respiration vs. water column?</li> <li>Scenario testing: How will land-use change affect downstream hypoxia?</li> <li>Model intercomparison: How do different organic matter formulations compare?</li> </ul> <p>The 1D framework runs 100-1000x faster than equivalent 2D models, enabling: - Monte Carlo uncertainty quantification - Parameter optimization with evolutionary algorithms - Ensemble projections under climate scenarios</p>"},{"location":"physics/introduction/#4-open-and-transparent","title":"4. Open and Transparent","text":"<p>C-GEM is: - Open source: ANSI C code you can read, modify, and extend - Self-contained: No proprietary dependencies - Portable: Runs on Windows, Linux, macOS - Well-documented: Every equation traceable to literature</p> <p>Compare this to commercial models where the code is a black box.</p>"},{"location":"physics/introduction/#when-to-use-c-gem-vs-other-models","title":"When to Use C-GEM vs. Other Models","text":""},{"location":"physics/introduction/#use-c-gem-when","title":"Use C-GEM When:","text":"<p>\u2705 You're studying biogeochemical processes (carbon, nutrients, GHG) \u2705 Your system is a tidal river network (delta, estuary) \u2705 You need fast computation for calibration, sensitivity, scenarios \u2705 You want full control over the code and equations \u2705 Your focus is research rather than operational forecasting \u2705 You care about GHG emissions (CO2, CH4, N2O)  </p>"},{"location":"physics/introduction/#use-2d3d-models-when","title":"Use 2D/3D Models When:","text":"<p>\u26a0\ufe0f You need spatially-resolved results (plume mapping, lateral gradients) \u26a0\ufe0f Morphodynamics are important (channel migration, delta evolution) \u26a0\ufe0f You're doing operational forecasting with GUI needs \u26a0\ufe0f Stratification is important (deep estuaries, fjords) \u26a0\ufe0f You have resources for complex setup and computation  </p>"},{"location":"physics/introduction/#the-mekong-delta-use-case","title":"The Mekong Delta Use Case","text":"<p>The Mekong Delta is an ideal C-GEM application:</p> <ol> <li>Complex network: 9 major distributaries, numerous bifurcations</li> <li>Strong tidal forcing: Semi-diurnal, 2-3 m range</li> <li>High biogeochemical activity: Tropical temperatures, nutrient-rich</li> <li>Documented GHG emissions: Published pCO2 and CH4 measurements</li> <li>Urgent management needs: Climate change, upstream dams, urbanization</li> </ol> <p>Existing models (Delft3D, MIKE) have been applied for: - Flood risk assessment (World Bank, MRC studies) - Salt intrusion forecasting (DONRE, SIWRP) - Navigation channel design</p> <p>But no process-based GHG emission model exists for the Mekong Delta network.</p> <p>C-GEM fills this gap by providing: - Mechanistic carbon cycling (not empirical export coefficients) - Process attribution (benthic vs. pelagic, autotrophic vs. heterotrophic) - Spatial patterns along the network - Temporal dynamics at tidal to seasonal scales</p>"},{"location":"physics/introduction/#scientific-foundation","title":"Scientific Foundation","text":"<p>C-GEM builds on decades of estuarine biogeochemistry research:</p>"},{"location":"physics/introduction/#hydrodynamics","title":"Hydrodynamics","text":"<ul> <li>Savenije (2005, 2015): Analytical salt intrusion in alluvial estuaries</li> <li>Abbott (1979): Computational hydraulics, staggered grids</li> </ul>"},{"location":"physics/introduction/#biogeochemistry","title":"Biogeochemistry","text":"<ul> <li>Billen et al. (1994): Original RIVE formulation</li> <li>Garnier et al. (2002): RIVE in the Seine River</li> <li>Wang et al. (2018): C-RIVE sensitivity analysis</li> <li>Wang et al. (2022): Unified RIVE v1.0</li> </ul>"},{"location":"physics/introduction/#carbonate-chemistry","title":"Carbonate Chemistry","text":"<ul> <li>Weiss (1974): CO2 solubility</li> <li>Zeebe &amp; Wolf-Gladrow (2001): CO2 in seawater</li> <li>Marescaux et al. (2019): Carbonate speciation in rivers</li> </ul>"},{"location":"physics/introduction/#greenhouse-gases","title":"Greenhouse Gases","text":"<ul> <li>Garnier et al. (2007): N2O in rivers</li> <li>Borges &amp; Abril (2011): GHG in estuaries</li> <li>Regnier et al. (2013): CO2 evasion from inland waters</li> </ul>"},{"location":"physics/introduction/#summary-c-gems-unique-value","title":"Summary: C-GEM's Unique Value","text":"Aspect C-GEM Strength Scope Biogeochemistry-focused, not hydrodynamics-first Complexity Right-sized: captures processes without excessive computation Science State-of-the-art C-RIVE, 30+ years of development Speed 1000x faster than 2D, enables sensitivity/calibration Openness Fully open source, transparent equations GHG Complete CO2/CH4/N2O module, rare in 1D models Networks Native multi-branch topology, essential for deltas <p>C-GEM doesn't replace TELEMAC or Delft3D\u2014it complements them by providing a research-grade biogeochemical framework for the questions those models weren't designed to answer efficiently.</p>"},{"location":"physics/introduction/#next-steps","title":"Next Steps","text":"<ul> <li>Hydrodynamics Module - Saint-Venant equations and numerical scheme</li> <li>Transport Module - Advection-dispersion and TVD schemes</li> <li>Biogeochemistry Module - C-RIVE, carbonate chemistry, GHG</li> </ul>"},{"location":"physics/sediment/","title":"Sediment Transport","text":""},{"location":"physics/sediment/#overview","title":"Overview","text":"<p>The sediment module simulates suspended particulate matter (SPM) dynamics including:</p> <ul> <li>Erosion and deposition based on shear stress</li> <li>Salinity-dependent flocculation (ETM formation)</li> <li>Light attenuation effects on phytoplankton</li> </ul>"},{"location":"physics/sediment/#governing-equation","title":"Governing Equation","text":"<p>SPM transport with settling:</p> \\[\\frac{\\partial (A \\cdot SPM)}{\\partial t} + \\frac{\\partial (Q \\cdot SPM)}{\\partial x} = \\frac{\\partial}{\\partial x}\\left(A K \\frac{\\partial SPM}{\\partial x}\\right) + A(E - D)\\] <p>Where: - \\(E\\) = Erosion rate [mg/L/s] - \\(D\\) = Deposition rate [mg/L/s]</p>"},{"location":"physics/sediment/#erosion","title":"Erosion","text":""},{"location":"physics/sediment/#partheniades-formula","title":"Partheniades Formula","text":"\\[E = M_e \\left(\\frac{\\tau_b}{\\tau_{crit,e}} - 1\\right)^n \\quad \\text{when } \\tau_b &gt; \\tau_{crit,e}\\] <p>Where: - \\(M_e\\) = Erosion coefficient [mg/m\u00b2/s] - \\(\\tau_b\\) = Bed shear stress [Pa] - \\(\\tau_{crit,e}\\) = Critical erosion stress [Pa] - \\(n\\) = Exponent (typically 1)</p>"},{"location":"physics/sediment/#bed-shear-stress","title":"Bed Shear Stress","text":"<p>From hydrodynamics:</p> \\[\\tau_b = \\rho \\frac{g U |U|}{C^2}\\]"},{"location":"physics/sediment/#deposition","title":"Deposition","text":""},{"location":"physics/sediment/#krone-formula","title":"Krone Formula","text":"\\[D = w_s \\cdot SPM \\cdot \\left(1 - \\frac{\\tau_b}{\\tau_{crit,d}}\\right) \\quad \\text{when } \\tau_b &lt; \\tau_{crit,d}\\] <p>Where: - \\(w_s\\) = Settling velocity [m/s] - \\(\\tau_{crit,d}\\) = Critical deposition stress [Pa]</p>"},{"location":"physics/sediment/#flocculation-model","title":"Flocculation Model","text":""},{"location":"physics/sediment/#salinity-dependent-settling","title":"Salinity-Dependent Settling","text":"<p>In estuaries, salinity enhances flocculation:</p> \\[w_s(S) = w_{s,0} \\cdot f_{floc}(S)\\] \\[f_{floc}(S) = 1 + (f_{max} - 1) \\cdot \\tanh\\left(\\frac{S}{S_{scale}}\\right)\\] <p>Where: - \\(w_{s,0}\\) = Base settling velocity (freshwater) - \\(f_{max}\\) = Maximum flocculation factor - \\(S_{scale}\\) = Salinity scale for flocculation</p>"},{"location":"physics/sediment/#typical-values","title":"Typical Values","text":"Parameter Mekong Loire Unit \\(w_{s,0}\\) 0.5 0.3 mm/s \\(f_{max}\\) 8 5 - \\(S_{scale}\\) 2 3 PSU"},{"location":"physics/sediment/#estuarine-turbidity-maximum-etm","title":"Estuarine Turbidity Maximum (ETM)","text":"<p>The flocculation model creates the ETM:</p> <pre><code>SPM (mg/L)\n    200 \u2524                  \u256d\u2500\u2500\u2500\u2500\u256e\n        \u2502                 \u2571      \u2572\n    150 \u2524               \u2571         \u2572\n        \u2502              \u2571           \u2572\n    100 \u2524            \u2571              \u2572\n        \u2502          \u2571                 \u2572\n     50 \u2524       \u2571                     \u2572\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n        \u2502    \u2571                             \n      0 \u253c\u2500\u2500\u2500\u256f\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n        0    10    20    30    40    50    60\n                 Distance from mouth (km)\n                    \u2191\n                   ETM\n</code></pre>"},{"location":"physics/sediment/#parameters","title":"Parameters","text":"Parameter Symbol Default Range Unit Base settling velocity \\(w_{s,0}\\) 0.0005 0.0001-0.003 m/s Critical erosion stress \\(\\tau_{crit,e}\\) 0.3 0.1-0.8 Pa Critical deposition stress \\(\\tau_{crit,d}\\) 0.08 0.03-0.2 Pa Erosion coefficient \\(M_e\\) 0.0001 0.00001-0.001 kg/m\u00b2/s Flocculation max \\(f_{max}\\) 8 3-15 - Salinity scale \\(S_{scale}\\) 2 1-5 PSU"},{"location":"physics/sediment/#implementation","title":"Implementation","text":""},{"location":"physics/sediment/#key-functions","title":"Key Functions","text":"<pre><code>// src/rive/sediment.c\n\nint Sediment_Branch(Branch *b, double dt) {\n    // For each grid cell\n    for (int i = 1; i &lt;= b-&gt;M; i++) {\n        double tau = calc_bed_shear(b, i);\n        double sal = b-&gt;conc[SPECIES_SALINITY][i];\n\n        // Flocculation-enhanced settling\n        double ws = calc_settling_velocity(sal, b-&gt;biogeo);\n\n        // Erosion\n        double E = 0.0;\n        if (tau &gt; tau_crit_ero) {\n            E = M_ero * (tau / tau_crit_ero - 1.0);\n        }\n\n        // Deposition\n        double D = 0.0;\n        if (tau &lt; tau_crit_dep) {\n            D = ws * b-&gt;conc[SPECIES_SPM][i] * (1.0 - tau / tau_crit_dep);\n        }\n\n        // Update SPM\n        b-&gt;conc[SPECIES_SPM][i] += (E - D) * dt / b-&gt;depth[i];\n    }\n}\n</code></pre>"},{"location":"physics/sediment/#light-attenuation","title":"Light Attenuation","text":"<p>SPM affects phytoplankton through light attenuation:</p> \\[I(z) = I_0 \\exp(-k_d z)\\] \\[k_d = k_{bg} + k_{SPM} \\cdot SPM\\] <p>Where: - \\(k_{bg}\\) = Background attenuation [m\u207b\u00b9] - \\(k_{SPM}\\) = SPM-specific attenuation [m\u00b2/g]</p> <p>Depth-averaged light:</p> \\[\\bar{I} = \\frac{I_0}{k_d H}\\left(1 - e^{-k_d H}\\right)\\]"},{"location":"physics/sediment/#references","title":"References","text":"<ol> <li> <p>Partheniades, E. (1965). Erosion and deposition of cohesive soils. J. Hydraul. Div., 91(1), 105-139.</p> </li> <li> <p>Krone, R.B. (1962). Flume studies of the transport of sediment in estuarial shoaling processes. University of California.</p> </li> <li> <p>Winterwerp, J.C. (2002). On the flocculation and settling velocity of estuarine mud. Continental Shelf Research, 22(9), 1339-1360.</p> </li> </ol>"},{"location":"physics/transport/","title":"Transport Module","text":""},{"location":"physics/transport/#overview","title":"Overview","text":"<p>The C-GEM transport module solves the advection-dispersion equation for scalar concentrations, including salinity, nutrients, organic matter, and dissolved gases. It employs TVD (Total Variation Diminishing) schemes for numerical stability and Savenije's theory for tidal dispersion.</p>"},{"location":"physics/transport/#governing-equation","title":"Governing Equation","text":""},{"location":"physics/transport/#1d-advection-dispersion","title":"1D Advection-Dispersion","text":"\\[\\frac{\\partial (AC)}{\\partial t} + \\frac{\\partial (QC)}{\\partial x} = \\frac{\\partial}{\\partial x}\\left(A K \\frac{\\partial C}{\\partial x}\\right) + A \\cdot S\\] <p>Where: - \\(C\\) = Concentration [unit/m\u00b3] - \\(A\\) = Cross-sectional area [m\u00b2] - \\(Q\\) = Discharge [m\u00b3/s] - \\(K\\) = Longitudinal dispersion coefficient [m\u00b2/s] - \\(S\\) = Source/sink term [unit/m\u00b3/s]</p>"},{"location":"physics/transport/#conservative-form","title":"Conservative Form","text":"<p>For numerical stability, rewritten as:</p> \\[\\frac{\\partial C}{\\partial t} + U\\frac{\\partial C}{\\partial x} = \\frac{1}{A}\\frac{\\partial}{\\partial x}\\left(A K \\frac{\\partial C}{\\partial x}\\right) + S\\] <p>Where \\(U = Q/A\\) is the cross-sectional average velocity.</p>"},{"location":"physics/transport/#tidal-dispersion-savenijes-theory","title":"Tidal Dispersion: Savenije's Theory","text":""},{"location":"physics/transport/#physical-mechanism","title":"Physical Mechanism","text":"<p>In tidal estuaries, longitudinal dispersion arises from:</p> <ol> <li>Tidal pumping: Correlation between tidal velocity and concentration</li> <li>Trapping: Side embayments fill on flood, release on ebb</li> <li>Residual circulation: Gravitational circulation in stratified areas</li> <li>Shear dispersion: Vertical/lateral velocity gradients</li> </ol>"},{"location":"physics/transport/#van-den-burghs-coefficient","title":"Van den Burgh's Coefficient","text":"<p>Savenije (2005) showed that dispersion in alluvial estuaries follows:</p> \\[\\frac{dK}{dx} = -K \\cdot \\beta\\] <p>Where \\(\\beta\\) is the Van den Burgh coefficient (dimensionless, typically 0.2-0.8).</p> <p>This leads to:</p> \\[K(x) = K_0 \\exp(-\\beta x / L_c)\\] <p>Where: - \\(K_0\\) = Dispersion at the mouth [m\u00b2/s] - \\(L_c\\) = Convergence length [m] - \\(\\beta\\) = Van den Burgh coefficient [-]</p>"},{"location":"physics/transport/#dispersion-at-the-mouth","title":"Dispersion at the Mouth","text":"\\[K_0 = \\frac{1400 \\cdot H_0 \\cdot \\sqrt{g H_0}}{f \\cdot N_r}\\] <p>Where: - \\(H_0\\) = Depth at mouth [m] - \\(f\\) = Darcy-Weisbach friction factor \u2248 \\(8g/C^2\\) - \\(N_r\\) = Canter-Cremers estuary number = \\(Q_r T / P_t\\) - \\(Q_r\\) = River discharge [m\u00b3/s] - \\(T\\) = Tidal period [s] - \\(P_t\\) = Tidal prism [m\u00b3]</p>"},{"location":"physics/transport/#typical-values-for-mekong-delta","title":"Typical Values for Mekong Delta","text":"Parameter Dry Season Wet Season \\(K_0\\) 500-1000 m\u00b2/s 200-500 m\u00b2/s \\(\\beta\\) 0.3-0.5 0.4-0.6 Salt intrusion 50-70 km 10-30 km"},{"location":"physics/transport/#numerical-scheme","title":"Numerical Scheme","text":""},{"location":"physics/transport/#operator-splitting","title":"Operator Splitting","text":"<p>The transport equation is split into:</p> <ol> <li>Advection step: \\(\\frac{\\partial C}{\\partial t} + U\\frac{\\partial C}{\\partial x} = 0\\)</li> <li>Dispersion step: \\(\\frac{\\partial C}{\\partial t} = \\frac{1}{A}\\frac{\\partial}{\\partial x}\\left(AK\\frac{\\partial C}{\\partial x}\\right)\\)</li> <li>Reaction step: \\(\\frac{\\partial C}{\\partial t} = S\\)</li> </ol>"},{"location":"physics/transport/#tvd-advection-schemes","title":"TVD Advection Schemes","text":"<p>To prevent numerical oscillations near sharp fronts (e.g., salinity intrusion), C-GEM uses Total Variation Diminishing schemes.</p> <p>First-order upwind (diffusive but stable):</p> \\[F_{i+1/2} = \\begin{cases} U_{i+1/2} C_i &amp; \\text{if } U &gt; 0 \\\\ U_{i+1/2} C_{i+1} &amp; \\text{if } U &lt; 0 \\end{cases}\\] <p>Second-order with flux limiter (less diffusive):</p> \\[F_{i+1/2} = F^{low}_{i+1/2} + \\psi(r) (F^{high}_{i+1/2} - F^{low}_{i+1/2})\\] <p>Where \\(\\psi(r)\\) is a limiter function and \\(r\\) is the ratio of consecutive gradients.</p>"},{"location":"physics/transport/#flux-limiters","title":"Flux Limiters","text":"Limiter Formula Properties Minmod \\(\\max(0, \\min(1, r))\\) Most diffusive TVD Van Leer $\\frac{r + r Superbee \\(\\max(0, \\min(2r, 1), \\min(r, 2))\\) Least diffusive TVD MC \\(\\max(0, \\min(2r, (1+r)/2, 2))\\) Monotonized central <p>C-GEM default: Van Leer (good balance of accuracy and stability)</p>"},{"location":"physics/transport/#dispersion-implicit-crank-nicolson","title":"Dispersion: Implicit Crank-Nicolson","text":"\\[\\frac{C^{n+1}_i - C^n_i}{\\Delta t} = \\frac{\\theta}{A_i \\Delta x^2}\\left[A_{i+1/2}K_{i+1/2}(C^{n+1}_{i+1} - C^{n+1}_i) - A_{i-1/2}K_{i-1/2}(C^{n+1}_i - C^{n+1}_{i-1})\\right] + (1-\\theta)[\\text{same at } n]\\] <p>With \\(\\theta = 0.5\\) (Crank-Nicolson) for second-order time accuracy.</p> <p>This yields a tridiagonal system solved by Thomas algorithm.</p>"},{"location":"physics/transport/#boundary-conditions","title":"Boundary Conditions","text":""},{"location":"physics/transport/#downstream-ocean-boundary","title":"Downstream (Ocean) Boundary","text":"<p>Flood tide (flow into estuary): \\(\\(C_{boundary} = C_{ocean}\\)\\)</p> <p>Ebb tide (flow out of estuary): \\(\\(\\frac{\\partial C}{\\partial x} = 0 \\quad \\text{(zero gradient)}\\)\\)</p> <p>This allows the model to \"exhale\" its own water during ebb.</p>"},{"location":"physics/transport/#upstream-river-boundary","title":"Upstream (River) Boundary","text":"\\[C_{boundary} = C_{river}(t)\\] <p>Time-varying boundary conditions can represent: - Seasonal nutrient loads - Episodic pollution events - Diurnal patterns (e.g., photosynthesis)</p>"},{"location":"physics/transport/#junction-mixing","title":"Junction Mixing","text":"<p>At network junctions, concentrations mix according to flow:</p> \\[C_{mixed} = \\frac{\\sum_i Q_i C_i}{\\sum_i Q_i}\\] <p>Branches receiving flow from the junction use \\(C_{mixed}\\) as their boundary condition.</p>"},{"location":"physics/transport/#species-specific-transport","title":"Species-Specific Transport","text":""},{"location":"physics/transport/#transported-species","title":"Transported Species","text":"Index Species Notes 0 Salinity Conservative tracer 1-2 PHY1, PHY2 Phytoplankton (settling) 3 DSi Dissolved silica 4-5 NO3, NH4 Nitrogen species 6 PO4 Phosphate 7 O2 Dissolved oxygen 9 SPM Suspended sediment (settling) 10-11 DIC, TA Carbonate system 17-26 RIVE pools Organic matter, bacteria 27-29 NO2, N2O, CH4 GHG species"},{"location":"physics/transport/#diagnostic-species-not-transported","title":"Diagnostic Species (Not Transported)","text":"Index Species Computed From 8 TOC Sum of OC pools 12 pCO2 Carbonate equilibrium 13 CO2 Carbonate equilibrium 14 pH DIC and TA"},{"location":"physics/transport/#settling","title":"Settling","text":"<p>Particulate species settle at velocity \\(w_s\\):</p> \\[S_{settling} = -\\frac{w_s}{H} C\\] <p>Typical settling velocities: - PHY: 0.1-1.0 m/day - SPM: 1-10 m/day (size-dependent) - HP (particulate OC): 0.5-2.0 m/day</p>"},{"location":"physics/transport/#numerical-stability","title":"Numerical Stability","text":""},{"location":"physics/transport/#peclet-number","title":"Peclet Number","text":"<p>For advection-dispersion stability:</p> \\[Pe = \\frac{U \\Delta x}{K} &lt; 2\\] <p>If \\(Pe &gt; 2\\), numerical oscillations may occur. Solutions: - Reduce \\(\\Delta x\\) - Use TVD scheme - Increase \\(K\\) (artificial dispersion)</p>"},{"location":"physics/transport/#courant-number","title":"Courant Number","text":"<p>For advection:</p> \\[Cr = \\frac{U \\Delta t}{\\Delta x} &lt; 1\\] <p>For typical estuarine conditions (\\(U\\) = 1 m/s, \\(\\Delta x\\) = 2000 m):</p> \\[\\Delta t &lt; 2000 \\text{ s}\\] <p>The default \\(\\Delta t\\) = 300 s provides a safety factor of ~7.</p>"},{"location":"physics/transport/#mass-conservation","title":"Mass Conservation","text":"<p>C-GEM monitors total mass in each branch:</p> \\[M = \\sum_i A_i C_i \\Delta x\\] <p>Mass should be conserved to &lt; 0.1% over a tidal cycle (excluding reactions).</p>"},{"location":"physics/transport/#salt-intrusion-validation","title":"Salt Intrusion Validation","text":""},{"location":"physics/transport/#savenijes-analytical-solution","title":"Savenije's Analytical Solution","text":"<p>For a converging estuary with exponential width:</p> \\[S(x) = S_0 \\exp\\left(-\\frac{x}{L_s}\\right)\\] <p>Where the intrusion length \\(L_s\\) depends on: - River discharge \\(Q_r\\) - Tidal range - Geometry (\\(B_0\\), \\(H_0\\), \\(L_c\\))</p>"},{"location":"physics/transport/#salt-intrusion-length","title":"Salt Intrusion Length","text":"<p>Empirical relation (Savenije 2005):</p> \\[L_s = \\frac{H_0 \\cdot C^2}{2g} \\cdot \\frac{1}{N_r}\\] <p>For the Mekong in dry season: - \\(H_0\\) \u2248 10 m - \\(C\\) \u2248 50 m^{\u00bd}/s - \\(N_r\\) \u2248 0.1 - \\(L_s\\) \u2248 60-70 km (matches observations)</p>"},{"location":"physics/transport/#calibration-procedure","title":"Calibration Procedure","text":"<ol> <li>Run with observed river discharge</li> <li>Compare simulated vs. observed salinity at stations</li> <li>Adjust \\(K_0\\) and \\(\\beta\\) to match intrusion length</li> <li>Verify tidal salinity variation</li> </ol>"},{"location":"physics/transport/#implementation","title":"Implementation","text":""},{"location":"physics/transport/#main-transport-function","title":"Main Transport Function","text":"<pre><code>int Transport_Branch(Branch *branch, double dt);\nint Transport_Branch_Network(Branch *branch, double dt, void *network_ptr);\n</code></pre> <p>Steps: 1. Compute dispersion coefficients 2. Apply boundary conditions (flow-dependent) 3. Build tridiagonal matrix for dispersion 4. Solve for each transported species 5. Apply flux limiters for advection</p>"},{"location":"physics/transport/#dispersion-configuration","title":"Dispersion Configuration","text":"<pre><code>void ComputeDispersionCoefficient(Branch *branch, double Q_total);\n</code></pre> <p>Uses Savenije's theory: <pre><code>// K = K0 * exp(-beta * x / Lc)\ndouble K0 = branch-&gt;D0;\ndouble beta = branch-&gt;vdb_coef;\ndouble Lc = branch-&gt;lc_convergence;\n</code></pre></p>"},{"location":"physics/transport/#species-transport-flags","title":"Species Transport Flags","text":"<p>In <code>define.h</code>: <pre><code>static const int CGEM_SPECIES_TRANSPORT_FLAG[CGEM_NUM_SPECIES] = {\n    1,  // SALINITY - transport\n    1,  // PHY1 - transport\n    ...\n    0,  // TOC - diagnostic (computed)\n    0,  // pCO2 - diagnostic (computed)\n    ...\n};\n</code></pre></p>"},{"location":"physics/transport/#example-salinity-profile","title":"Example: Salinity Profile","text":""},{"location":"physics/transport/#initial-condition","title":"Initial Condition","text":"<p>Linear gradient from ocean to river: <pre><code>x=0 (ocean):   S = 30 PSU\nx=L (river):   S = 0 PSU\n</code></pre></p>"},{"location":"physics/transport/#after-1-tidal-cycle","title":"After 1 Tidal Cycle","text":"<p>Tidal mixing creates characteristic profile: <pre><code>          30 |____\n             |    \\___\nSalinity     |        \\___\n(PSU)     15 |            \\___\n             |                \\___\n           0 |____________________\\____\n             0     20    40    60    80 km\n</code></pre></p>"},{"location":"physics/transport/#seasonal-variation","title":"Seasonal Variation","text":"<pre><code>Dry season:  Intrusion 60-70 km, S &gt; 4 at Can Tho\nWet season:  Intrusion 10-20 km, S &lt; 1 at Can Tho\n</code></pre>"},{"location":"physics/transport/#references","title":"References","text":"<ol> <li>Savenije, H.H.G. (2005). Salinity and Tides in Alluvial Estuaries. Elsevier.</li> <li>Fischer, H.B. et al. (1979). Mixing in Inland and Coastal Waters. Academic Press.</li> <li>Van Leer, B. (1979). Towards the ultimate conservative difference scheme. J. Comput. Phys.</li> <li>Sweby, P.K. (1984). High resolution schemes using flux limiters. SIAM J. Numer. Anal.</li> <li>Nguyen, A.D. et al. (2008). Salt intrusion in multi-channel estuaries: Mekong Delta. Water Resour. Res.</li> </ol>"},{"location":"physics/transport/#next-biogeochemistry-module","title":"Next: Biogeochemistry Module","text":""},{"location":"physics/transport/#next-sediment-module","title":"Next: Sediment Module","text":""},{"location":"user-guide/calibration/","title":"Calibration","text":""},{"location":"user-guide/calibration/#overview","title":"Overview","text":"<p>C-GEM includes a built-in calibration module powered by NLopt, supporting:</p> <ul> <li>Multi-stage calibration: Hydro \u2192 Sediment \u2192 Biogeochemistry</li> <li>Multiple algorithms: BOBYQA, Nelder-Mead, DIRECT, COBYLA</li> <li>Seasonal objectives: Time-series RMSE for dry/wet season</li> <li>Config-driven: No recompilation needed</li> </ul>"},{"location":"user-guide/calibration/#quick-start","title":"Quick Start","text":"<pre><code># Full 3-stage calibration\n.\\bin\\Debug\\CGEM_Network.exe INPUT/Cases/Mekong_Delta_Full/case_config.txt --calibrate\n\n# Single stage with options\n.\\bin\\Debug\\CGEM_Network.exe INPUT/Cases/Mekong_Delta_Full/case_config.txt \\\n    --calibrate --stage 1 --max-iter 100 --verbose 2\n</code></pre>"},{"location":"user-guide/calibration/#command-line-options","title":"Command-Line Options","text":"Option Description Default <code>--calibrate</code> Enable calibration mode Off <code>--stage N</code> Run only stage N (1, 2, or 3) All stages <code>--max-iter N</code> Maximum optimizer iterations 100 <code>--verbose N</code> Verbosity level (0-2) 1"},{"location":"user-guide/calibration/#three-stage-workflow","title":"Three-Stage Workflow","text":""},{"location":"user-guide/calibration/#stage-1-hydrodynamics","title":"Stage 1: Hydrodynamics","text":"<p>Goal: Match tidal propagation and salinity intrusion</p> <p>Parameters:</p> Name Description Typical Range Unit <code>CHEZY</code> Friction coefficient 40-80 m^0.5/s <code>LC_CONV</code> Convergence length 10-100 km <code>VDB_COEF</code> Van den Burgh coefficient 0.1-0.8 - <code>D0</code> Dispersion at mouth 100-2000 m\u00b2/s <code>RS</code> Storage width ratio 1-15 - <p>Objectives:</p> <ul> <li>Tidal range at gauging stations</li> <li>Salinity intrusion length (4 PSU isohaline)</li> <li>Mean velocity at key sections</li> </ul>"},{"location":"user-guide/calibration/#stage-2-sediment-transport","title":"Stage 2: Sediment Transport","text":"<p>Goal: Reproduce SPM patterns and ETM location</p> <p>Parameters:</p> Name Description Typical Range Unit <code>WS</code> Settling velocity 0.1-3.0 mm/s <code>TAU_ERO</code> Critical erosion stress 0.1-0.8 Pa <code>TAU_DEP</code> Critical deposition stress 0.03-0.2 Pa <code>FLOC_FACTOR</code> Flocculation enhancement 1-15 - <p>Objectives:</p> <ul> <li>Mean SPM at monitoring stations</li> <li>ETM location (maximum turbidity position)</li> </ul>"},{"location":"user-guide/calibration/#stage-3-biogeochemistry","title":"Stage 3: Biogeochemistry","text":"<p>Goal: Match water quality observations</p> <p>Parameters:</p> Name Description Typical Range Unit <code>KOX</code> Aerobic degradation rate 0.02-0.3 d\u207b\u00b9 <code>KNIT</code> Nitrification rate 0.03-0.25 d\u207b\u00b9 <code>KDENIT</code> Denitrification rate 0.01-0.1 d\u207b\u00b9 <code>PBMAX</code> Max photosynthesis rate 1-4 d\u207b\u00b9 <code>KMORT</code> Mortality rate 0.02-0.2 d\u207b\u00b9 <p>Objectives:</p> <ul> <li>O\u2082 concentration at stations</li> <li>Nutrient concentrations (NO\u2083, NH\u2084, PO\u2084)</li> <li>Chlorophyll-a (via PHY1 + PHY2)</li> </ul>"},{"location":"user-guide/calibration/#configuration-files","title":"Configuration Files","text":""},{"location":"user-guide/calibration/#calibration_paramscsv","title":"calibration_params.csv","text":"<p>Defines parameters to optimize:</p> <pre><code>Name,TargetType,TargetID,VarType,Min,Max,Initial,Stage\nChezy_River,BRANCH,Tien_Main,CHEZY,45,75,60,1\nChezy_Estuary,BRANCH,Ham_Luong,CHEZY,40,70,55,1\nVDB_Estuary,BRANCH,Co_Chien,VDB_COEF,0.1,0.6,0.3,1\nWS_Global,GLOBAL,-,WS,0.0001,0.003,0.0005,2\nKox_Global,GLOBAL,-,KOX,0.02,0.3,0.08,3\n</code></pre> <p>Columns:</p> Column Description <code>Name</code> Parameter identifier <code>TargetType</code> <code>BRANCH</code> or <code>GLOBAL</code> <code>TargetID</code> Branch name (if BRANCH) or <code>-</code> <code>VarType</code> Variable type (CHEZY, VDB_COEF, WS, etc.) <code>Min</code>, <code>Max</code> Parameter bounds <code>Initial</code> Starting value <code>Stage</code> Calibration stage (1, 2, or 3)"},{"location":"user-guide/calibration/#calibration_targetscsv","title":"calibration_targets.csv","text":"<p>Defines calibration objectives:</p> <pre><code>BranchName,Variable,Statistic,TargetValue,Weight,Threshold\nHam_Luong,SALINITY,INTRUSION_LEN,55.0,50.0,4.0\nCo_Chien,SALINITY,MEAN,15.0,30.0,\nHau_River,O2,MEAN,180.0,40.0,\n</code></pre> <p>Columns:</p> Column Description <code>BranchName</code> Target branch <code>Variable</code> Species name or WATERLEVEL/VELOCITY <code>Statistic</code> MEAN, MIN, MAX, INTRUSION_LEN, ETM_LOCATION <code>TargetValue</code> Observed value <code>Weight</code> Importance (higher = more weight) <code>Threshold</code> For intrusion: salinity threshold (PSU)"},{"location":"user-guide/calibration/#seasonal_targetscsv-new","title":"seasonal_targets.csv (NEW)","text":"<p>Defines time-series observations for seasonal calibration:</p> <pre><code>Branch,Variable,Location_km,Time_Day,Value,Weight\nHam_Luong,SALINITY,30.0,15.0,25.0,2.0\nHam_Luong,SALINITY,30.0,180.0,0.5,1.0\nCo_Chien,SALINITY,25.0,15.0,28.0,2.0\nCo_Chien,SALINITY,25.0,180.0,0.8,1.0\n</code></pre> <p>Columns:</p> Column Description <code>Branch</code> Target branch name <code>Variable</code> Species name <code>Location_km</code> Distance from mouth [km] <code>Time_Day</code> Day from simulation start <code>Value</code> Observed value <code>Weight</code> Importance <p>This allows calibration against both dry season (Day 15) and wet season (Day 180) observations simultaneously.</p>"},{"location":"user-guide/calibration/#nlopt-algorithms","title":"NLopt Algorithms","text":"<p>C-GEM supports multiple optimization algorithms:</p> Algorithm ID Name Description Best For 0 <code>NELDERMEAD</code> Derivative-free simplex General use 1 <code>BOBYQA</code> Bounded optimization (default) Recommended 2 <code>DIRECT</code> Global optimization Exploring parameter space 3 <code>COBYLA</code> Constrained optimization With constraints 4 <code>CRS2_LM</code> Controlled random search Global search 5 <code>SBPLX</code> Subplex Noisy objectives <p>Set algorithm in code or use the default (BOBYQA).</p>"},{"location":"user-guide/calibration/#output","title":"Output","text":""},{"location":"user-guide/calibration/#console-output","title":"Console Output","text":"<pre><code>==============================================\n  CALIBRATION MODE\n==============================================\n\nLoaded 30 calibration parameters from calibration_params.csv\nLoaded 32 calibration objectives from calibration_targets.csv\nLoaded 14 seasonal observation groups from seasonal_targets.csv\n\nOptimizing 11 parameters for stage 1 using NLopt\nNLopt algorithm: BOBYQA bound-constrained optimization\nMax evaluations: 100\nTolerance: rel=1.00e-04, abs=1.00e-06\n\n  Eval 1: RMSE = 45.2341\n  Eval 2: RMSE = 42.1234\n  ...\n  Eval 50: RMSE = 12.4523\n\nNLopt result: FTOL_REACHED (code 4)\nOptimization complete: best RMSE = 12.4523 after 50 evaluations\n\n========== CALIBRATION SUMMARY ==========\n\nOPTIMIZED PARAMETERS:\nName                      Initial    Best       Min        Max\n--------------------------------------------------------------\nChezy_River                  60.0000    58.5234    45.0000    75.0000\nVDB_Estuary                   0.3000     0.4521     0.1000     0.6000\n...\n\nFinal RMSE: 12.4523\nTotal evaluations: 50\n</code></pre>"},{"location":"user-guide/calibration/#results-file","title":"Results File","text":"<p>Results are saved to <code>OUTPUT/&lt;CaseName&gt;/calibration/calibration_results.csv</code>:</p> <pre><code># C-GEM Calibration Results\n# Final RMSE: 12.4523\n# Total evaluations: 50\n\n# Optimized Parameters\nName,VarType,Initial,Best,Min,Max,Stage\nChezy_River,CHEZY,60.000000,58.523400,45.000000,75.000000,1\nVDB_Estuary,VDB_COEF,0.300000,0.452100,0.100000,0.600000,1\n...\n</code></pre>"},{"location":"user-guide/calibration/#best-practices","title":"Best Practices","text":""},{"location":"user-guide/calibration/#1-start-with-hydrodynamics","title":"1. Start with Hydrodynamics","text":"<p>Always calibrate Stage 1 first. Biogeochemistry results depend on correct hydrodynamics.</p>"},{"location":"user-guide/calibration/#2-use-reasonable-bounds","title":"2. Use Reasonable Bounds","text":"<p>Tight bounds speed convergence but may miss optimal values:</p> <pre><code># Too tight - may miss optimum\nChezy_River,BRANCH,Tien_Main,CHEZY,55,65,60,1\n\n# Too loose - slow convergence\nChezy_River,BRANCH,Tien_Main,CHEZY,20,100,60,1\n\n# Good - informed by literature\nChezy_River,BRANCH,Tien_Main,CHEZY,45,75,60,1\n</code></pre>"},{"location":"user-guide/calibration/#3-weight-objectives-appropriately","title":"3. Weight Objectives Appropriately","text":"<p>Primary objectives should have higher weights:</p> <pre><code># Primary: salinity intrusion (weight 50)\nHam_Luong,SALINITY,INTRUSION_LEN,55.0,50.0,4.0\n\n# Secondary: mean concentration (weight 20)\nHam_Luong,O2,MEAN,180.0,20.0,\n</code></pre>"},{"location":"user-guide/calibration/#4-include-seasonal-data","title":"4. Include Seasonal Data","text":"<p>For tropical systems with strong wet/dry contrast, use seasonal_targets.csv:</p> <pre><code># Dry season peak (Day 15)\nHam_Luong,SALINITY,30.0,15.0,25.0,2.0\n\n# Wet season minimum (Day 180)  \nHam_Luong,SALINITY,30.0,180.0,0.5,1.0\n</code></pre>"},{"location":"user-guide/calibration/#5-validate-results","title":"5. Validate Results","text":"<p>After calibration:</p> <ol> <li>Run simulation with best parameters</li> <li>Compare time series visually</li> <li>Check spatial patterns</li> <li>Test with independent data (if available)</li> </ol>"},{"location":"user-guide/data-preparation/","title":"Data Preparation","text":""},{"location":"user-guide/data-preparation/#input-directory-structure","title":"Input Directory Structure","text":"<p>Each simulation case requires a directory under <code>INPUT/Cases/</code>:</p> <pre><code>INPUT/Cases/YourCase/\n\u251c\u2500\u2500 case_config.txt           # Main configuration\n\u251c\u2500\u2500 topology.csv              # Network structure\n\u251c\u2500\u2500 boundary_map.csv          # Boundary conditions\n\u251c\u2500\u2500 biogeo_params.txt         # Biogeochemistry parameters (optional)\n\u251c\u2500\u2500 species_river.csv         # Upstream species concentrations\n\u251c\u2500\u2500 species_ocean.csv         # Ocean species concentrations\n\u251c\u2500\u2500 lateral_sources.csv       # Point/diffuse loads (optional)\n\u251c\u2500\u2500 calibration_params.csv    # Calibration parameters (optional)\n\u251c\u2500\u2500 calibration_targets.csv   # Calibration objectives (optional)\n\u2514\u2500\u2500 seasonal_targets.csv      # Seasonal observations (optional)\n</code></pre>"},{"location":"user-guide/data-preparation/#1-main-configuration","title":"1. Main Configuration","text":""},{"location":"user-guide/data-preparation/#case_configtxt","title":"case_config.txt","text":"<pre><code># Case identification\nCaseName = Mekong_Delta_Full\n\n# Input file paths (relative to case directory)\nTopology = topology.csv\nBoundaryMap = boundary_map.csv\nBiogeoParams = biogeo_params.txt\n\n# Output\nOutputDir = OUTPUT/Mekong_Delta_Full\nWriteCSV = 1\nWriteNetCDF = 0\nWriteReactionRates = 0\n\n# Time parameters\nStartDate = 2024-03-01\nDuration = 30              # days\nWarmup = 10                # days before recording output\n\n# Numerical parameters\nTimeStep = 300.0           # dt [s]\nDELXI = 2000.0             # grid spacing [m]\n</code></pre>"},{"location":"user-guide/data-preparation/#parameter-descriptions","title":"Parameter Descriptions","text":"Parameter Type Description <code>CaseName</code> string Case identifier <code>Topology</code> path Branch definitions file <code>BoundaryMap</code> path Boundary conditions file <code>BiogeoParams</code> path Biogeochemistry parameters (optional) <code>OutputDir</code> path Output directory <code>StartDate</code> date Simulation start (YYYY-MM-DD) <code>Duration</code> int Simulation duration [days] <code>Warmup</code> int Warmup period [days] <code>TimeStep</code> float Time step [seconds] <code>DELXI</code> float Target grid spacing [meters]"},{"location":"user-guide/data-preparation/#2-network-topology","title":"2. Network Topology","text":""},{"location":"user-guide/data-preparation/#topologycsv","title":"topology.csv","text":"<p>Defines branches in the network:</p> <pre><code>BranchID,BranchName,NodeUp,NodeDown,Length_m,Width_Down_m,Width_Up_m,Depth_m,Chezy,RS\n1,Tien_Main,1,3,48000,1200,1000,15,55,1.0\n2,Hau_Main,2,3,44000,1100,900,14,55,1.0\n3,Vam_Nao,3,4,8000,600,600,18,65,1.0\n</code></pre>"},{"location":"user-guide/data-preparation/#column-descriptions","title":"Column Descriptions","text":"Column Type Unit Description <code>BranchID</code> int - Unique branch identifier <code>BranchName</code> string - Human-readable name <code>NodeUp</code> int - Upstream node ID <code>NodeDown</code> int - Downstream node ID <code>Length_m</code> float m Branch length <code>Width_Down_m</code> float m Width at downstream end <code>Width_Up_m</code> float m Width at upstream end <code>Depth_m</code> float m Reference depth <code>Chezy</code> float m^0.5/s Friction coefficient <code>RS</code> float - Storage width ratio (RS \u2265 1)"},{"location":"user-guide/data-preparation/#optional-columns","title":"Optional Columns","text":"Column Type Unit Description <code>LC_m</code> float m Convergence length (if not computed) <code>VDB</code> float - Van den Burgh coefficient <code>Manning</code> float s/m^\u2153 Manning's n (alternative to Chezy)"},{"location":"user-guide/data-preparation/#3-boundary-conditions","title":"3. Boundary Conditions","text":""},{"location":"user-guide/data-preparation/#boundary_mapcsv","title":"boundary_map.csv","text":"<p>Assigns boundary conditions to nodes:</p> <pre><code>NodeID,BoundaryType,ForcingFile,SpeciesFile\n1,DISCHARGE,upstream_Q_tien.csv,species_river.csv\n2,DISCHARGE,upstream_Q_hau.csv,species_river.csv\n6,LEVEL,tide_cochien.csv,species_ocean.csv\n7,LEVEL,tide_mytho.csv,species_ocean.csv\n</code></pre>"},{"location":"user-guide/data-preparation/#boundary-types","title":"Boundary Types","text":"Type Description Required Forcing <code>DISCHARGE</code> River inflow Q [m\u00b3/s] time series <code>LEVEL</code> Tidal boundary H [m] time series <code>JUNCTION</code> Internal node (automatic)"},{"location":"user-guide/data-preparation/#forcing-file-format","title":"Forcing File Format","text":"<pre><code>time_hours,value\n0.0,2500.0\n1.0,2510.0\n2.0,2495.0\n...\n</code></pre> <p>For tidal boundaries: <pre><code>time_hours,value\n0.0,0.5\n0.5,1.2\n1.0,1.8\n1.5,1.5\n2.0,0.8\n...\n</code></pre></p>"},{"location":"user-guide/data-preparation/#4-species-boundary-conditions","title":"4. Species Boundary Conditions","text":""},{"location":"user-guide/data-preparation/#species_rivercsv-upstream","title":"species_river.csv (upstream)","text":"<pre><code>time_days,salinity,phy1,phy2,dsi,no3,nh4,po4,o2,toc,spm,dic,at\n0,0.1,50,30,120,30,5,1.5,280,800,50,1800,1900\n14,0.1,80,50,100,35,8,2.0,260,900,80,1850,1950\n...\n</code></pre>"},{"location":"user-guide/data-preparation/#species_oceancsv-downstream","title":"species_ocean.csv (downstream)","text":"<pre><code>time_days,salinity,phy1,phy2,dsi,no3,nh4,po4,o2,toc,spm,dic,at\n0,35,10,5,5,2,0.5,0.3,220,200,10,2100,2300\n14,35,15,8,6,3,0.8,0.4,210,220,15,2100,2300\n...\n</code></pre>"},{"location":"user-guide/data-preparation/#species-units","title":"Species Units","text":"Species Unit Typical Range salinity PSU 0-35 phy1, phy2 \u00b5g C/L 0-500 dsi \u00b5mol/L 0-200 no3, nh4 \u00b5mol N/L 0-100 po4 \u00b5mol P/L 0-10 o2 \u00b5mol/L 0-400 toc \u00b5mol C/L 100-2000 spm mg/L 0-500 dic \u00b5mol/L 1000-3000 at \u00b5mol/L 1500-3000"},{"location":"user-guide/data-preparation/#5-biogeochemistry-parameters","title":"5. Biogeochemistry Parameters","text":""},{"location":"user-guide/data-preparation/#biogeo_paramstxt","title":"biogeo_params.txt","text":"<pre><code># Phytoplankton\npbmax1 = 2.5          # Max photosynthesis rate PHY1 [d-1]\npbmax2 = 2.0          # Max photosynthesis rate PHY2 [d-1]\nkmort1 = 0.08         # Mortality rate PHY1 [d-1]\nkmort2 = 0.06         # Mortality rate PHY2 [d-1]\n\n# Nutrients\nkox = 0.08            # Aerobic degradation rate [d-1]\nknit = 0.10           # Nitrification rate [d-1]\nkdenit = 0.03         # Denitrification rate [d-1]\n\n# Oxygen\nwind_k = 0.25         # Wind enhancement coefficient\ncurrent_k = 0.30      # Current enhancement coefficient\n\n# Sediment\nws_base = 0.0005      # Base settling velocity [m/s]\ntau_ero = 0.30        # Critical erosion stress [Pa]\ntau_dep = 0.08        # Critical deposition stress [Pa]\nfloc_sal_scale = 2.0  # Flocculation salinity scale [PSU]\nfloc_factor_max = 8.0 # Max flocculation enhancement [-]\n\n# Salinity stress (freshwater phytoplankton)\nsal_stress_thresh = 5.0   # Onset of stress [PSU]\nsal_stress_coef = 0.5     # Mortality enhancement [-]\n</code></pre>"},{"location":"user-guide/data-preparation/#6-lateral-sources-optional","title":"6. Lateral Sources (Optional)","text":""},{"location":"user-guide/data-preparation/#lateral_sourcescsv","title":"lateral_sources.csv","text":"<p>Point and diffuse pollution loads:</p> <pre><code>BranchName,Location_km,Q_m3_s,NH4_umol,NO3_umol,PO4_umol,TOC_umol\nHam_Luong,25.0,0.5,100,20,5,500\nCo_Chien,30.0,0.3,80,15,3,400\n...\n</code></pre>"},{"location":"user-guide/data-preparation/#7-calibration-files","title":"7. Calibration Files","text":""},{"location":"user-guide/data-preparation/#calibration_paramscsv","title":"calibration_params.csv","text":"<pre><code>Name,TargetType,TargetID,VarType,Min,Max,Initial,Stage\nChezy_River,BRANCH,Tien_Main,CHEZY,45,75,60,1\nChezy_Estuary,BRANCH,Ham_Luong,CHEZY,40,70,55,1\nVDB_Estuary,BRANCH,Co_Chien,VDB_COEF,0.1,0.6,0.3,1\nWS_Global,GLOBAL,-,WS,0.0001,0.003,0.0005,2\nKox_Global,GLOBAL,-,KOX,0.02,0.3,0.08,3\n</code></pre>"},{"location":"user-guide/data-preparation/#calibration_targetscsv","title":"calibration_targets.csv","text":"<pre><code>BranchName,Variable,Statistic,TargetValue,Weight,Threshold\nHam_Luong,SALINITY,INTRUSION_LEN,55.0,50.0,4.0\nCo_Chien,SALINITY,MEAN,15.0,30.0,\nHau_River,O2,MEAN,180.0,40.0,\n</code></pre>"},{"location":"user-guide/data-preparation/#seasonal_targetscsv","title":"seasonal_targets.csv","text":"<pre><code>Branch,Variable,Location_km,Time_Day,Value,Weight\nHam_Luong,SALINITY,30.0,15.0,25.0,2.0\nHam_Luong,SALINITY,30.0,180.0,0.5,1.0\nCo_Chien,SALINITY,25.0,15.0,28.0,2.0\n</code></pre>"},{"location":"user-guide/data-preparation/#data-sources","title":"Data Sources","text":""},{"location":"user-guide/data-preparation/#typical-data-sources-for-tropical-deltas","title":"Typical Data Sources for Tropical Deltas","text":"Data Type Sources Discharge MRC, national hydrology agencies Tidal levels NOAA, local tide gauges Water quality EPA, monitoring programs Satellite Sentinel-\u2154 (Chl-a, SPM) Bathymetry Nautical charts, surveys"},{"location":"user-guide/data-preparation/#minimum-data-requirements","title":"Minimum Data Requirements","text":"Priority Data Impact Essential Discharge, tidal levels Drives entire system Important Salinity, SPM Calibration targets Useful O\u2082, nutrients Biogeochemistry validation Optional CO\u2082, CH\u2084 GHG budget"},{"location":"user-guide/output/","title":"Output Analysis","text":""},{"location":"user-guide/output/#output-file-structure","title":"Output File Structure","text":""},{"location":"user-guide/output/#csv-output","title":"CSV Output","text":"<p>Each branch has a CSV file with time series at multiple locations:</p> <pre><code>OUTPUT/CaseName/CSV/\n\u251c\u2500\u2500 Branch1.csv\n\u251c\u2500\u2500 Branch2.csv\n\u2514\u2500\u2500 ...\n</code></pre>"},{"location":"user-guide/output/#csv-format","title":"CSV Format","text":"<pre><code>time_days,depth_x1,depth_x5,depth_x10,...,salinity_x1,salinity_x5,...\n0.000,15.2,15.1,15.0,...,32.5,28.3,...\n0.042,15.5,15.3,15.1,...,32.8,29.1,...\n0.083,15.1,14.9,14.8,...,31.9,27.5,...\n</code></pre> <p>Columns: - <code>time_days</code>: Simulation time [days] - <code>variable_xN</code>: Variable at grid index N (where N=1 is downstream)</p>"},{"location":"user-guide/output/#variables-in-output","title":"Variables in Output","text":"Category Variables Hydrodynamics depth, velocity, waterlevel, area, width, dispersion Salinity salinity Phytoplankton phy1, phy2 Nutrients dsi, no3, nh4, po4, no2 Oxygen o2 Carbon toc, dic, at, pco2, co2, ph Sediment spm GHG n2o, ch4"},{"location":"user-guide/output/#loading-data-in-python","title":"Loading Data in Python","text":""},{"location":"user-guide/output/#basic-loading","title":"Basic Loading","text":"<pre><code>import pandas as pd\nimport numpy as np\n\n# Load single branch\ndf = pd.read_csv('OUTPUT/Mekong_Delta_Full/CSV/Ham_Luong.csv')\n\n# Available columns\nprint(df.columns.tolist())\n\n# Time series at specific location\ntime = df['time_days']\nsal_30km = df['salinity_x15']  # x15 = index 15 \u2248 30 km from mouth\n</code></pre>"},{"location":"user-guide/output/#loading-all-branches","title":"Loading All Branches","text":"<pre><code>import os\n\noutput_dir = 'OUTPUT/Mekong_Delta_Full/CSV'\nbranches = {}\n\nfor f in os.listdir(output_dir):\n    if f.endswith('.csv'):\n        name = f.replace('.csv', '')\n        branches[name] = pd.read_csv(os.path.join(output_dir, f))\n\n# Access specific branch\nham_luong = branches['Ham_Luong']\n</code></pre>"},{"location":"user-guide/output/#visualization","title":"Visualization","text":""},{"location":"user-guide/output/#time-series-plot","title":"Time Series Plot","text":"<pre><code>import matplotlib.pyplot as plt\n\nfig, axes = plt.subplots(2, 2, figsize=(14, 10))\n\n# Salinity at different locations\nax = axes[0, 0]\nfor x in [5, 15, 25]:\n    col = f'salinity_x{x}'\n    if col in df.columns:\n        ax.plot(df['time_days'], df[col], label=f'{x*2} km')\nax.set_xlabel('Time (days)')\nax.set_ylabel('Salinity (PSU)')\nax.set_title('Salinity Time Series')\nax.legend()\nax.grid(True, alpha=0.3)\n\n# Velocity\nax = axes[0, 1]\nax.plot(df['time_days'], df['velocity_x10'])\nax.set_xlabel('Time (days)')\nax.set_ylabel('Velocity (m/s)')\nax.set_title('Velocity at 20 km')\nax.grid(True, alpha=0.3)\n\n# Water level\nax = axes[1, 0]\nax.plot(df['time_days'], df['waterlevel_x5'])\nax.set_xlabel('Time (days)')\nax.set_ylabel('Water Level (m)')\nax.set_title('Water Level at 10 km')\nax.grid(True, alpha=0.3)\n\n# SPM\nax = axes[1, 1]\nfor x in [5, 15, 25]:\n    col = f'spm_x{x}'\n    if col in df.columns:\n        ax.plot(df['time_days'], df[col], label=f'{x*2} km')\nax.set_xlabel('Time (days)')\nax.set_ylabel('SPM (mg/L)')\nax.set_title('Suspended Sediment')\nax.legend()\nax.grid(True, alpha=0.3)\n\nplt.tight_layout()\nplt.savefig('results_overview.png', dpi=150)\n</code></pre>"},{"location":"user-guide/output/#longitudinal-profile","title":"Longitudinal Profile","text":"<pre><code>def get_longitudinal_profile(df, variable, time_idx):\n    \"\"\"Extract longitudinal profile at specific time\"\"\"\n    cols = [c for c in df.columns if c.startswith(f'{variable}_x')]\n    values = df.iloc[time_idx][[c for c in cols]].values\n\n    # Extract x indices\n    x_indices = [int(c.split('_x')[1]) for c in cols]\n    x_km = np.array(x_indices) * 2  # Assuming 2 km grid\n\n    return x_km, values\n\n# Plot profile at day 15\ntime_idx = int(15 / 0.042)  # Convert to row index\nx, sal = get_longitudinal_profile(df, 'salinity', time_idx)\n\nplt.figure(figsize=(10, 6))\nplt.plot(x, sal, 'b-', linewidth=2)\nplt.xlabel('Distance from mouth (km)')\nplt.ylabel('Salinity (PSU)')\nplt.title('Salinity Profile at Day 15')\nplt.grid(True, alpha=0.3)\nplt.savefig('salinity_profile.png', dpi=150)\n</code></pre>"},{"location":"user-guide/output/#multi-branch-comparison","title":"Multi-Branch Comparison","text":"<pre><code>fig, ax = plt.subplots(figsize=(12, 6))\n\nbranches_to_plot = ['Ham_Luong', 'Co_Chien', 'My_Tho', 'Hau_River']\n\nfor branch in branches_to_plot:\n    df = pd.read_csv(f'OUTPUT/Mekong_Delta_Full/CSV/{branch}.csv')\n    # Plot salinity at 30 km\n    col = 'salinity_x15'\n    if col in df.columns:\n        ax.plot(df['time_days'], df[col], label=branch)\n\nax.set_xlabel('Time (days)')\nax.set_ylabel('Salinity at 30 km (PSU)')\nax.legend()\nax.grid(True, alpha=0.3)\nplt.savefig('branch_comparison.png', dpi=150)\n</code></pre>"},{"location":"user-guide/output/#netcdf-conversion","title":"NetCDF Conversion","text":""},{"location":"user-guide/output/#convert-binary-to-netcdf","title":"Convert Binary to NetCDF","text":"<pre><code>python scripts/bin_to_nc.py OUTPUT/Mekong_Delta_Full\n</code></pre>"},{"location":"user-guide/output/#load-netcdf","title":"Load NetCDF","text":"<pre><code>import netCDF4 as nc\n\nds = nc.Dataset('OUTPUT/Mekong_Delta_Full/Mekong_Delta_Full.nc')\n\n# List variables\nprint(ds.variables.keys())\n\n# Extract data\ntime = ds.variables['time'][:]\nx = ds.variables['x'][:]\nsalinity = ds.variables['salinity'][:, :]  # (time, x)\n</code></pre>"},{"location":"user-guide/output/#statistical-analysis","title":"Statistical Analysis","text":""},{"location":"user-guide/output/#basic-statistics","title":"Basic Statistics","text":"<pre><code># Time-averaged profile\nsal_mean = df[[c for c in df.columns if c.startswith('salinity_x')]].mean()\n\n# Tidal range\ndepth_cols = [c for c in df.columns if c.startswith('depth_x')]\ntidal_range = df[depth_cols].max() - df[depth_cols].min()\n\n# Salt intrusion length (4 PSU)\ndef calc_intrusion_length(df, threshold=4.0, dx=2.0):\n    \"\"\"Calculate salt intrusion length\"\"\"\n    sal_cols = sorted([c for c in df.columns if c.startswith('salinity_x')],\n                      key=lambda x: int(x.split('_x')[1]))\n\n    intrusions = []\n    for _, row in df.iterrows():\n        for i, col in enumerate(sal_cols):\n            if row[col] &lt; threshold:\n                intrusions.append(i * dx)\n                break\n        else:\n            intrusions.append(len(sal_cols) * dx)\n\n    return intrusions\n\nintrusion = calc_intrusion_length(df)\nprint(f\"Mean intrusion: {np.mean(intrusion):.1f} km\")\nprint(f\"Max intrusion: {np.max(intrusion):.1f} km\")\n</code></pre>"},{"location":"user-guide/output/#tidal-analysis","title":"Tidal Analysis","text":"<pre><code>from scipy import signal\n\n# Extract tidal signal\ndepth = df['depth_x10'].values\ntime_hours = df['time_days'].values * 24\n\n# Find peaks (high tide)\npeaks, _ = signal.find_peaks(depth, distance=10)\ntroughs, _ = signal.find_peaks(-depth, distance=10)\n\n# Calculate tidal range\ntidal_ranges = []\nfor i in range(min(len(peaks), len(troughs))):\n    tr = depth[peaks[i]] - depth[troughs[i]]\n    tidal_ranges.append(abs(tr))\n\nprint(f\"Mean tidal range: {np.mean(tidal_ranges):.2f} m\")\n</code></pre>"},{"location":"user-guide/output/#export-for-other-tools","title":"Export for Other Tools","text":""},{"location":"user-guide/output/#export-to-excel","title":"Export to Excel","text":"<pre><code>with pd.ExcelWriter('results.xlsx') as writer:\n    for branch, df in branches.items():\n        df.to_excel(writer, sheet_name=branch, index=False)\n</code></pre>"},{"location":"user-guide/output/#export-summary-statistics","title":"Export Summary Statistics","text":"<pre><code>summary = []\nfor branch, df in branches.items():\n    sal_cols = [c for c in df.columns if c.startswith('salinity_x')]\n    summary.append({\n        'Branch': branch,\n        'Mean_Salinity': df[sal_cols].mean().mean(),\n        'Max_Salinity': df[sal_cols].max().max(),\n        'Mean_Depth': df[[c for c in df.columns if c.startswith('depth_x')]].mean().mean()\n    })\n\npd.DataFrame(summary).to_csv('summary_stats.csv', index=False)\n</code></pre>"},{"location":"user-guide/overview/","title":"Model Overview","text":""},{"location":"user-guide/overview/#conceptual-framework","title":"Conceptual Framework","text":"<p>C-GEM Network simulates the coupled hydrodynamics and biogeochemistry of tidal river networks through four main modules:</p> <pre><code>flowchart LR\n    subgraph HYDRO[Hydrodynamics]\n        SV[Saint-Venant] --&gt; Q[Discharge Q]\n        SV --&gt; H[Water Level H]\n    end\n\n    subgraph TRANS[Transport]\n        ADV[Advection] --&gt; C[Concentration]\n        DISP[Dispersion] --&gt; C\n    end\n\n    subgraph BIOGEO[Biogeochemistry]\n        PHY[Phytoplankton] --&gt; NPP[NPP]\n        BAC[Bacteria] --&gt; RESP[Respiration]\n        NIT[Nitrification] --&gt; N2O[N\u2082O]\n    end\n\n    subgraph SED[Sediment]\n        ERO[Erosion] --&gt; SPM[SPM]\n        DEP[Deposition] --&gt; SPM\n    end\n\n    HYDRO --&gt;|U, H| TRANS\n    TRANS --&gt;|C| BIOGEO\n    BIOGEO --&gt;|sinking| SED\n    SED --&gt;|turbidity| BIOGEO</code></pre> <p>Learn more - Data preparation and input files</p>"},{"location":"user-guide/overview/#time-stepping","title":"Time Stepping","text":"<p>Each simulation time step (typically 300 s):</p> <ol> <li>Hydrodynamics: Solve Saint-Venant equations for H, U</li> <li>Transport: Advect-disperse all species</li> <li>Biogeochemistry: Update reaction rates, modify concentrations</li> <li>Sediment: Erosion/deposition based on shear stress</li> </ol> <pre><code>flowchart TD\n    boundary[\"Update boundary conditions &lt;br&gt; Interpolate Q(t), H(t), C(t)\"]\n    hydro[\"Hydrodynamics&lt;br&gt;(solver_hydro.c)&lt;br&gt;Solve Saint-Venant&lt;br&gt;Junction iterations&lt;br&gt;Update H, U, A\"]\n    transport[\"Transport&lt;br&gt;(transport.c)&lt;br&gt;Advection + dispersion&lt;br&gt;Update concentrations&lt;br&gt;Junction mixing\"]\n    biogeo[\"Biogeochemistry&lt;br&gt;(biogeo.c)&lt;br&gt;Phytoplankton, nutrients, oxygen, carbonate, GHG\"]\n    sediment[\"Sediment&lt;br&gt;(sediment.c)&lt;br&gt;Shear stress&lt;br&gt;Erosion + deposition\"]\n    output[\"Output&lt;br&gt;CSV/Binary (when interval reached)\"]\n    boundary --&gt; hydro --&gt; transport --&gt; biogeo --&gt; sediment --&gt; output</code></pre> <p>Learn more - Running simulations and time step control</p>"},{"location":"user-guide/overview/#species-and-variables","title":"Species and Variables","text":""},{"location":"user-guide/overview/#hydrodynamic-variables-6","title":"Hydrodynamic Variables (6)","text":"Variable Symbol Unit Description <code>depth</code> \\(H\\) m Water depth <code>velocity</code> \\(U\\) m/s Cross-sectional average velocity <code>waterlevel</code> \\(\\zeta\\) m Water surface elevation <code>area</code> \\(A\\) m\u00b2 Cross-sectional area <code>width</code> \\(B\\) m Channel width <code>dispersion</code> \\(K\\) m\u00b2/s Longitudinal dispersion coefficient"},{"location":"user-guide/overview/#biogeochemical-species-30","title":"Biogeochemical Species (30)","text":"Index Name Symbol Unit Description 0 <code>salinity</code> SAL PSU Conservative tracer 1 <code>phy1</code> PHY1 \u00b5g C/L Diatoms (siliceous) 2 <code>phy2</code> PHY2 \u00b5g C/L Green algae 3 <code>dsi</code> DSi \u00b5mol/L Dissolved silica 4 <code>no3</code> NO\u2083 \u00b5mol N/L Nitrate 5 <code>nh4</code> NH\u2084 \u00b5mol N/L Ammonium 6 <code>po4</code> PO\u2084 \u00b5mol P/L Phosphate 7 <code>o2</code> O\u2082 \u00b5mol/L Dissolved oxygen 8 <code>toc</code> TOC \u00b5mol C/L Total organic carbon 9 <code>spm</code> SPM mg/L Suspended particulate matter 10 <code>dic</code> DIC \u00b5mol/L Dissolved inorganic carbon 11 <code>at</code> TA \u00b5mol/L Total alkalinity 12 <code>pco2</code> pCO\u2082 \u00b5atm Partial pressure CO\u2082 (diagnostic) 13 <code>co2</code> CO\u2082(aq) \u00b5mol/L Aqueous CO\u2082 (diagnostic) 14 <code>ph</code> pH - pH (diagnostic) 15 <code>hs</code> HS\u207b \u00b5mol/L Sulfide 27 <code>no2</code> NO\u2082 \u00b5mol N/L Nitrite 28 <code>n2o</code> N\u2082O nmol N/L Nitrous oxide 29 <code>ch4</code> CH\u2084 \u00b5mol C/L Methane"},{"location":"user-guide/overview/#reaction-rates-35","title":"Reaction Rates (35+)","text":"Index Name Description Unit 0-2 <code>npp_no3</code> NPP using NO\u2083 \u00b5mol C/L/d 3-5 <code>npp_nh4</code> NPP using NH\u2084 \u00b5mol C/L/d 6-7 <code>gpp</code> Gross primary production \u00b5mol C/L/d 8 <code>npp</code> Net primary production \u00b5mol C/L/d 9-11 <code>phy_death</code> Phytoplankton mortality \u00b5mol C/L/d 12 <code>si_cons</code> Silica consumption \u00b5mol/L/d 13 <code>aer_deg</code> Aerobic degradation \u00b5mol C/L/d 14 <code>denit</code> Denitrification \u00b5mol N/L/d 15 <code>nit</code> Nitrification (step 1) \u00b5mol N/L/d 16-17 <code>o2_ex</code> O\u2082 air-water exchange \u00b5mol/L/d 18-19 <code>co2_ex</code> CO\u2082 air-water exchange \u00b5mol/L/d 40 <code>nit2</code> Nitratation (step 2) \u00b5mol N/L/d 41-43 <code>n2o_*</code> N\u2082O production/exchange nmol N/L/d 44-48 <code>ch4_*</code> CH\u2084 production/exchange \u00b5mol C/L/d"},{"location":"user-guide/overview/#network-topology","title":"Network Topology","text":"<p>C-GEM represents river networks as graphs:</p> <ul> <li>Branches: 1D channels with M grid cells</li> <li>Nodes: Connection points (junctions, boundaries)</li> <li>Connections: Each branch connects two nodes</li> </ul>"},{"location":"user-guide/overview/#node-types","title":"Node Types","text":"Type Description Boundary Condition <code>DISCHARGE_BC</code> River inflow Q = Q(t) from forcing <code>LEVEL_BC</code> Tidal boundary H = H(t) from forcing <code>JUNCTION</code> Internal node Mass balance: \u03a3Q = 0"},{"location":"user-guide/overview/#example-mekong-delta","title":"Example: Mekong Delta","text":"<pre><code>flowchart TB\n    node1[\"Node 1&lt;br/&gt;(Q)\"] --&gt; tienMain[\"Tien Main\"]\n    node2[\"Node 2&lt;br/&gt;(Q)\"] --&gt; hauMain[\"Hau Main\"]\n    tienMain --&gt; node3[\"Node 3&lt;br/&gt;(J)\"]\n    hauMain --&gt; node3\n    node3 --&gt; vamNao[\"Vam Nao\"]\n    vamNao --&gt; node4[\"Node 4\"]\n    vamNao --&gt; node5[\"Node 5\"]\n    node4 --&gt; tienLower[\"Tien Lower\"]\n    node5 --&gt; hauLower[\"Hau Lower\"]\n    tienLower --&gt; coChien[\"Co Chien\"]\n    tienLower --&gt; hamLuong[\"Ham Luong\"]\n    hauLower --&gt; hauRiver[\"Hau River\"]\n    coChien --&gt; node6[\"Node 6&lt;br/&gt;(H)\"]\n    hamLuong --&gt; node7[\"Node 7&lt;br/&gt;(H)\"]\n    hauRiver --&gt; node8[\"Node 8&lt;br/&gt;(H)\"]\n    hauRiver --&gt; node9[\"Node 9&lt;br/&gt;(H)\"]</code></pre>"},{"location":"user-guide/running/","title":"Running Simulations","text":""},{"location":"user-guide/running/#basic-usage","title":"Basic Usage","text":"<pre><code>.\\bin\\Debug\\CGEM_Network.exe &lt;config_file&gt; [options]\n</code></pre>"},{"location":"user-guide/running/#examples","title":"Examples","text":"<pre><code># Standard simulation\n.\\bin\\Debug\\CGEM_Network.exe INPUT/Cases/Mekong_Delta_Full/case_config.txt\n\n# With calibration\n.\\bin\\Debug\\CGEM_Network.exe INPUT/Cases/Mekong_Delta_Full/case_config.txt --calibrate\n\n# Calibration with options\n.\\bin\\Debug\\CGEM_Network.exe INPUT/Cases/Mekong_Delta_Full/case_config.txt \\\n    --calibrate --stage 1 --max-iter 100 --verbose 2\n</code></pre>"},{"location":"user-guide/running/#command-line-options","title":"Command-Line Options","text":"Option Description Default <code>--calibrate</code> Enable calibration mode Off <code>--stage N</code> Run only stage N (1-3) All stages <code>--max-iter N</code> Max optimizer iterations 100 <code>--verbose N</code> Verbosity (0-2) 1"},{"location":"user-guide/running/#output","title":"Output","text":""},{"location":"user-guide/running/#console-progress","title":"Console Progress","text":"<pre><code>==============================================\n  C-GEM Network Engine\n==============================================\n  Case        : Mekong_Delta_Full\n  Branches    : 9\n  Nodes       : 10\n  Species     : 30\n  Time step   : 300.0 s\n  Duration    : 30 days\n  Warmup      : 10 days\n==============================================\n\nDay    0.0 (  0.0%) [WARMUP] | H=15.00 m, U=0.100 m/s, S=0.1 | 0.0 s elapsed\nDay    1.0 (  3.3%) [WARMUP] | H=15.40 m, U=0.142 m/s, S=0.1 | 2.4 s elapsed\n...\nDay   30.0 (100.0%)          | H=15.41 m, U=0.154 m/s, S=26.4 | 76.6 s elapsed\n\nSimulation complete: 8640 steps in 76.6 seconds (112.8 steps/s)\nCSV output written to: .\\OUTPUT\\Mekong_Delta_Full/CSV\n</code></pre>"},{"location":"user-guide/running/#output-files","title":"Output Files","text":"<pre><code>OUTPUT/Mekong_Delta_Full/\n\u251c\u2500\u2500 CSV/\n\u2502   \u251c\u2500\u2500 Tien_Main.csv\n\u2502   \u251c\u2500\u2500 Hau_Main.csv\n\u2502   \u251c\u2500\u2500 Vam_Nao.csv\n\u2502   \u251c\u2500\u2500 Co_Chien.csv\n\u2502   \u251c\u2500\u2500 Ham_Luong.csv\n\u2502   \u2514\u2500\u2500 ...\n\u2514\u2500\u2500 calibration/  (if --calibrate)\n    \u2514\u2500\u2500 calibration_results.csv\n</code></pre> <p>Learn more - Detailed output file formats and post-processing</p>"},{"location":"user-guide/running/#helper-scripts","title":"Helper Scripts","text":""},{"location":"user-guide/running/#build-and-run","title":"Build and Run","text":"<pre><code># Build + run in one command\n.\\scripts\\build-and-run.ps1 -r Mekong_Delta_Full\n\n# Build + run different case\n.\\scripts\\build-and-run.ps1 -r Tien_River\n</code></pre>"},{"location":"user-guide/running/#convert-to-netcdf","title":"Convert to NetCDF","text":"<pre><code>python scripts/bin_to_nc.py OUTPUT/Mekong_Delta_Full\n</code></pre>"},{"location":"user-guide/running/#quick-plot","title":"Quick Plot","text":"<pre><code>python scripts/plot_netcdf.py OUTPUT/Mekong_Delta_Full/Mekong_Delta_Full.nc\n</code></pre>"},{"location":"user-guide/running/#performance-tips","title":"Performance Tips","text":""},{"location":"user-guide/running/#time-step-selection","title":"Time Step Selection","text":"Condition Recommended dt Deep channels (&gt;10m) 300-600 s Shallow areas (&lt;5m) 150-300 s Strong tides (&gt;3m) 150-300 s Calibration runs 300 s"},{"location":"user-guide/running/#grid-spacing","title":"Grid Spacing","text":"Application DELXI Research 500-1000 m Calibration 2000 m Screening 5000 m"},{"location":"user-guide/running/#expected-performance","title":"Expected Performance","text":"Grid Size Time Step Speed 100 cells 300 s ~500 steps/s 225 cells 300 s ~110 steps/s 500 cells 300 s ~50 steps/s"},{"location":"user-guide/running/#troubleshooting","title":"Troubleshooting","text":""},{"location":"user-guide/running/#simulation-unstable","title":"\"Simulation unstable\"","text":"<ol> <li>Reduce time step</li> <li>Check boundary conditions for jumps</li> <li>Verify geometry (width ratios)</li> </ol>"},{"location":"user-guide/running/#no-output-files","title":"\"No output files\"","text":"<ol> <li>Check <code>WriteCSV = 1</code></li> <li>Verify <code>OutputDir</code> exists</li> </ol>"},{"location":"user-guide/running/#nan-values-in-output","title":"\"NaN values in output\"","text":"<ol> <li>Check initial conditions</li> <li>Verify species boundary files</li> <li>Reduce biogeo time step</li> </ol>"}]}